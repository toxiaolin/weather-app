<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æ©˜å­è‰ºæœ¯ Â· èŒå¨ƒé‡‘å¥æŒ‘æˆ˜</title>
<style>
  :root {
    --primary: #ff7a00;
    --bg: #fff5ec;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: var(--bg);
    color: #333;
    overflow-x: hidden;
  }
  
  /* é¡µé¢åˆ‡æ¢æ§åˆ¶ */
  .page { display: none; min-height: 100vh; padding: 20px; flex-direction: column; align-items: center; }
  .page.active { display: flex; }

  /* é¦–é¡µ / æ‹ç…§é¡µ */
  .header { text-align: center; margin-top: 4vh; width: 100%; }
  .title { font-size: 26px; color: var(--primary); font-weight: bold; margin-bottom: 20px; }
  .question-card {
    background: #fff; border-radius: 16px; padding: 30px 20px;
    font-size: 22px; font-weight: bold; color: #333;
    box-shadow: 0 8px 24px rgba(255, 122, 0, 0.15);
    border: 3px solid #ffd0a6; text-align: center; margin-bottom: 40px;
  }
  .tips { color: #888; font-size: 14px; margin-bottom: 20px; text-align: center; }
  
  /* æŒ‰é’®æ ·å¼ */
  .btn {
    background: var(--primary); color: #fff; font-size: 18px; font-weight: bold;
    padding: 16px 32px; border-radius: 50px; border: none; width: 85%;
    text-align: center; display: inline-block; box-shadow: 0 6px 16px rgba(255,122,0,0.3);
    cursor: pointer; margin-top: auto; margin-bottom: 5vh; text-decoration: none;
  }
  .btn:active { transform: scale(0.98); }

  /* æµ·æŠ¥å±•ç¤ºé¡µ */
  #posterImage { width: 100%; max-width: 350px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: block; margin: 0 auto; }
  .share-tip { background: #ffe6d0; color: var(--primary); padding: 10px 20px; border-radius: 30px; margin: 20px 0; font-size: 15px; font-weight: bold; animation: pulse 1.5s infinite; }

  @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
</style>
</head>
<body>

  <!-- é¡µé¢ 1ï¼šæé—®ä¸æ‹ç…§ -->
  <div id="page-home" class="page active">
    <div class="header">
      <div class="title">âœ¨ èŒå¨ƒé‡‘å¥æŒ‘æˆ˜ âœ¨</div>
      <div class="tips">è¯·æ ¹æ®ä¸‹æ–¹é—®é¢˜ï¼Œæ‹ä¸€å¼ å®è´çš„ç…§ç‰‡</div>
      <div id="questionBox" class="question-card">æ­£åœ¨åŠ è½½é—®é¢˜...</div>
    </div>
    
    <label for="cameraInput" class="btn">ğŸ“· ç‚¹å‡»æ‹ç…§ç”Ÿæˆä¸“å±æµ·æŠ¥</label>
    <input id="cameraInput" type="file" accept="image/*" capture="environment" style="display:none;">
  </div>

  <!-- é¡µé¢ 2ï¼šæµ·æŠ¥é¢„è§ˆä¸å¼•å¯¼è½¬å‘ -->
  <div id="page-poster" class="page">
    <div class="title" style="font-size:20px; margin-bottom:10px;">æ‚¨çš„ä¸“å±æµ·æŠ¥å·²ç”Ÿæˆ</div>
    <img id="posterImage" src="" alt="æµ·æŠ¥">
    <div class="share-tip">ğŸ‘‡ è¯·é•¿æŒ‰ä¸Šæ–¹æµ·æŠ¥ä¿å­˜ï¼Œå¹¶å‘åˆ°æœ‹å‹åœˆ</div>
    
    <!-- è·³è½¬åˆ°è…¾è®¯æ–‡æ¡£æ”¶é›†è¡¨çš„æŒ‰é’® -->
    <button id="btn-shared" class="btn" style="margin-top:20px; margin-bottom:20px;">æˆ‘å·²å‘æœ‹å‹åœˆï¼Œå»é¢†å¥– ğŸ</button>
  </div>

  <!-- éšè—çš„ç”»å¸ƒï¼Œç”¨äºç”Ÿæˆæµ·æŠ¥ -->
  <canvas id="posterCanvas" width="800" height="1200" style="display:none;"></canvas>

<script>
/* ==================== 1. åˆå§‹åŒ–éšæœºé—®é¢˜ ==================== */
const questions = [
  "å¦‚æœå¦ˆå¦ˆæœ‰é­”æ³•ï¼Œç¬¬ä¸€ä»¶äº‹æƒ³å¸¦ä½ åšä»€ä¹ˆï¼Ÿ",
  "ç»™å¦ˆå¦ˆç”»ä¸€å¼ åƒï¼Œä½ ä¼šç»™å¥¹ç”»å‡ æ¡è…¿ï¼Ÿ",
  "å¦‚æœæ˜Ÿæ˜Ÿå¯ä»¥åƒï¼Œä½ è§‰å¾—æ˜¯ä»€ä¹ˆå‘³é“ï¼Ÿ"
];
const currentQuestion = questions[Math.floor(Math.random() * questions.length)];
document.getElementById("questionBox").innerText = currentQuestion;

/* ==================== 2. é¡µé¢è·¯ç”±æ§åˆ¶ ==================== */
function showPage(pageId) {
  document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
  window.scrollTo(0, 0);
}

/* ==================== 3. æ‹ç…§ä¸ç”Ÿæˆæµ·æŠ¥é€»è¾‘ ==================== */
document.getElementById("cameraInput").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if(!file) return;

  // æ˜¾ç¤ºåŠ è½½æç¤º
  document.getElementById("questionBox").innerText = "æµ·æŠ¥ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...";
  
  const reader = new FileReader();
  reader.onload = function(evt) {
    const photoBase64 = evt.target.result;
    
    // è°ƒç”¨æµ·æŠ¥ç»˜åˆ¶åŠŸèƒ½
    drawPoster("posterCanvas", {
      photo: photoBase64,
      title: currentQuestion
    }, function(posterUrl) {
      // æ˜¾ç¤ºæµ·æŠ¥é¡µ
      document.getElementById("posterImage").src = posterUrl;
      showPage("page-poster");
      // æ¢å¤é—®é¢˜æ–‡å­—
      document.getElementById("questionBox").innerText = currentQuestion;
    });
  };
  reader.readAsDataURL(file);
});

/* ==================== 4. â€œå»é¢†å¥–â€æŒ‰é’®ç›´æ¥è·³è½¬è…¾è®¯æ–‡æ¡£ ==================== */
document.getElementById("btn-shared").addEventListener("click", function() {
  
  // âš ï¸ æŠŠä¸‹é¢çš„é“¾æ¥æ›¿æ¢æˆä½ åšå¥½çš„è…¾è®¯æ–‡æ¡£æ”¶é›†è¡¨é“¾æ¥ âš ï¸
  const formUrl = "https://docs.qq.com/form/page/ã€è¿™é‡Œæ¢æˆä½ çš„è…¾è®¯æ–‡æ¡£æ”¶é›†è¡¨IDã€‘"; 
  
  window.location.href = formUrl;
});

/* ==================== 5. æµ·æŠ¥ç»˜åˆ¶å¼•æ“ (Canvas) ==================== */
function drawPoster(canvasId, opt, callback) {
  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext("2d");
  const W = canvas.width;
  const H = canvas.height;

  // 1. ç»˜åˆ¶åº•è‰² (å¡é€šè¾¹æ¡†èƒŒæ™¯åº•è‰²)
  ctx.fillStyle = "#fff5ec";
  ctx.fillRect(0, 0, W, H);

  // åŠ è½½ç”¨æˆ·ç…§ç‰‡
  const userImg = new Image();
  userImg.src = opt.photo;
  userImg.onload = function() {
    
    // 2. ç»˜åˆ¶ç”¨æˆ·ç…§ç‰‡ (å±…ä¸­è£å‰ª Cover æ¨¡å¼ï¼Œé˜²æ­¢æ‹‰ä¼¸å˜å½¢)
    const imgX = 50; 
    const imgY = 220;
    const imgW = W - 100; 
    const imgH = 680;
    
    // ç”»ä¸€ä¸ªç™½è‰²è¾¹æ¡†æ¨¡æ‹Ÿç›¸æ¡†
    ctx.fillStyle = "#ffffff";
    ctx.shadowColor = "rgba(0,0,0,0.1)";
    ctx.shadowBlur = 20;
    roundRect(ctx, imgX - 15, imgY - 15, imgW + 30, imgH + 30, 20, true);
    ctx.shadowBlur = 0; // æ¢å¤é˜´å½±

    // è£å‰ªä¸ç»˜åˆ¶å›¾ç‰‡
    ctx.save();
    roundRect(ctx, imgX, imgY, imgW, imgH, 10, false);
    ctx.clip();
    
    let scale = Math.max(imgW / userImg.width, imgH / userImg.height);
    let sw = imgW / scale;
    let sh = imgH / scale;
    let sx = (userImg.width - sw) / 2;
    let sy = (userImg.height - sh) / 2;
    ctx.drawImage(userImg, sx, sy, sw, sh, imgX, imgY, imgW, imgH);
    ctx.restore();

    // 3. ç»˜åˆ¶é¡¶éƒ¨é—®é¢˜æ¡†
    ctx.fillStyle = "#ff7a00";
    roundRect(ctx, 40, 60, W - 80, 120, 20, true);
    
    ctx.fillStyle = "#ffffff";
    ctx.font = "bold 38px sans-serif";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    wrapText(ctx, "Q: " + opt.title, W/2, 120, W - 120, 50);

    // 4. ç»˜åˆ¶åº•éƒ¨æ¨¡æ¿åŒºåŸŸ (å¦‚æœä½ è®¾è®¡éƒ¨åšå¥½äº†åº•éƒ¨é€æ˜PNGæµ·æŠ¥æ¡†ï¼Œå¯ä»¥ç›´æ¥è´´å›¾è¦†ç›–)
    ctx.fillStyle = "#ffffff";
    roundRect(ctx, 40, 940, W - 80, 220, 20, true);
    
    ctx.fillStyle = "#ff7a00";
    ctx.font = "bold 32px sans-serif";
    ctx.textAlign = "left";
    ctx.fillText("æ©˜å­è‰ºæœ¯ Â· å¯»æ‰¾å°å°åˆ›æ„å®¶", 80, 1010);
    
    ctx.fillStyle = "#666";
    ctx.font = "24px sans-serif";
    ctx.fillText("å‘æ˜å­©å­çš„æ— é™æ½œèƒ½", 80, 1060);
    ctx.fillText("æ‰«ç å…è´¹é¢†å–è¯•å¬è¯¾ â”", 80, 1110);

    // æ¨¡æ‹ŸäºŒç»´ç åŒºåŸŸï¼ˆå¯ä»¥æ›¿æ¢ä¸ºä½ çš„æœºæ„äºŒç»´ç å›¾ç‰‡ï¼‰
    ctx.fillStyle = "#ddd";
    ctx.fillRect(W - 220, 960, 140, 140);
    ctx.fillStyle = "#666";
    ctx.font = "16px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText("æ›¿æ¢ä¸ºæ‚¨çš„QR", W - 150, 1035);

    // å¯¼å‡ºå¹¶å›è°ƒ
    const url = canvas.toDataURL("image/jpeg", 0.9);
    if(callback) callback(url);
  };
}

/* è¾…åŠ©ï¼šåœ†è§’çŸ©å½¢ */
function roundRect(ctx, x, y, w, h, r, fill) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.arcTo(x + w, y, x + w, y + h, r);
  ctx.arcTo(x + w, y + h, x, y + h, r);
  ctx.arcTo(x, y + h, x, y, r);
  ctx.arcTo(x, y, x + w, y, r);
  ctx.closePath();
  if (fill) ctx.fill();
}

/* è¾…åŠ©ï¼šè‡ªåŠ¨æ¢è¡Œæ–‡æœ¬å±…ä¸­å¤„ç† */
function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
  const words = text.split('');
  let line = '';
  let lines = [];
  
  for (let n = 0; n < words.length; n++) {
    let testLine = line + words[n];
    let metrics = ctx.measureText(testLine);
    let testWidth = metrics.width;
    if (testWidth > maxWidth && n > 0) {
      lines.push(line);
      line = words[n];
    } else {
      line = testLine;
    }
  }
  lines.push(line);
  
  let startY = y - ((lines.length - 1) * lineHeight) / 2;
  for (let i = 0; i < lines.length; i++) {
    ctx.fillText(lines[i], x, startY + (i * lineHeight));
  }
}
</script>
</body>
</html>