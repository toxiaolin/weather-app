<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æ˜Ÿæ²™èŒå¨ƒ Â· æ°”è´¨å¤§èµ Â· ä¸‰å¯ç©</title>
<style>
  /* ================= æ ¸å¿ƒæš—é»‘ä¸»é¢˜å˜é‡ ================= */
  :root {
    --bg-dark: #13142B;
    --bg-card: rgba(255, 255, 255, 0.06);
    --border-glass: rgba(255, 255, 255, 0.12);
    --neon-purple: #B258FF;
    --text-main: #FFFFFF;
    --text-sub: #8E93A8;
    --icon-purple: linear-gradient(135deg, #A855F7 0%, #7E22CE 100%);
    --icon-pink: linear-gradient(135deg, #F43F5E 0%, #BE123C 100%);
    --icon-blue: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, sans-serif; -webkit-tap-highlight-color: transparent; }
  
  body {
    background: var(--bg-dark); color: var(--text-main); padding-bottom: 20px; overflow-x: hidden;
    background-image: radial-gradient(circle at 50% -20%, #2A2155 0%, var(--bg-dark) 60%);
    min-height: 100vh;
  }

  /* ================= éŸ³ä¹æŒ‰é’® ================= */
  .music-btn {
    position: fixed; top: 20px; right: 20px; width: 36px; height: 36px;
    background: rgba(255,255,255,0.1); border-radius: 50%; display: flex;
    justify-content: center; align-items: center; font-size: 18px; z-index: 999;
    animation: spin 3s linear infinite; cursor: pointer; border: 1px solid var(--border-glass);
  }
  .music-btn.paused { animation-play-state: paused; opacity: 0.5; }
  @keyframes spin { 100% { transform: rotate(360deg); } }

  /* ================= é¡µé¢åˆ‡æ¢åŠ¨ç”» ================= */
  .page { display: none; padding: 0 20px; flex-direction: column; align-items: center; width: 100%; }
  .page.active { display: flex; animation: fadeIn 0.4s ease forwards; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

  /* ================= é¡¶éƒ¨å¯¼èˆªä¸æ ‡é¢˜ ================= */
  .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; width: 100%; }
  .brand { display: flex; align-items: center; font-weight: 900; font-size: 16px; letter-spacing: 1px;}
  .neon-title { font-size: 44px; font-weight: 900; text-align: center; margin-top: 2vh; margin-bottom: 15px; line-height: 1.2; text-shadow: 0 0 10px rgba(178, 88, 255, 0.8), 0 0 20px rgba(178, 88, 255, 0.5); }
  .subtitle { font-size: 14px; color: var(--text-sub); margin-bottom: 10px; text-align: center; letter-spacing: 1px;}
  .highlight-text { font-size: 13px; color: #D8B4FE; font-weight: bold; background: rgba(178,88,255,0.1); padding: 6px 16px; border-radius: 20px; display: inline-block; margin-bottom: 30px;}

  /* ================= èœå•å¡ç‰‡ ================= */
  .menu-card { background: var(--bg-card); border: 1px solid var(--border-glass); border-radius: 24px; padding: 20px; width: 100%; display: flex; align-items: center; margin-bottom: 16px; backdrop-filter: blur(10px); cursor: pointer; transition: 0.2s; }
  .menu-card:active { transform: scale(0.96); }
  .menu-icon { width: 65px; height: 65px; border-radius: 18px; display: flex; justify-content: center; align-items: center; font-size: 30px; margin-right: 18px; color: #fff; }
  .menu-text { flex: 1; }
  .menu-text h3 { font-size: 20px; font-weight: bold; margin-bottom: 5px; color: #fff; }
  .menu-text p { font-size: 12px; color: var(--text-sub); line-height: 1.4; }
  
  .footer-info { margin-top: 4vh; text-align: center; width: 100%; padding-bottom: 30px;}
  .inner-card { background: var(--bg-card); border: 1px solid var(--border-glass); border-radius: 20px; padding: 25px 20px; width: 100%; margin-bottom: 20px; backdrop-filter: blur(10px); }
  
  .btn { background: var(--icon-purple); color: #fff; border: none; padding: 16px; border-radius: 30px; font-size: 18px; font-weight: bold; width: 100%; text-align: center; cursor: pointer; margin-top: 10px; }
  .btn:active { transform: scale(0.95); }
  .btn-outline { background: transparent; border: 1px solid var(--neon-purple); color: #D8B4FE; }
  
  /* ================= è¡¨å•ä¸é€‰é¡¹ ================= */
  input[type="text"], input[type="tel"], input[type="file"], select { width: 100%; padding: 16px; border: 1px solid var(--border-glass); border-radius: 12px; margin-bottom: 15px; background: rgba(0,0,0,0.2); font-size: 16px; color: #fff; outline: none; -webkit-appearance: none; appearance: none;}
  input::placeholder { color: #5B607A; }
  select:invalid { color: #5B607A; }
  select option { background: #13142B; color: #fff; }
  .quiz-option { background: rgba(255,255,255,0.05); border: 1px solid var(--border-glass); padding: 16px; border-radius: 12px; margin-bottom: 12px; font-size: 16px; text-align: center; cursor: pointer; color: #ccc; transition: 0.2s;}
  .quiz-option.selected { border-color: var(--neon-purple); background: rgba(178, 88, 255, 0.15); font-weight: bold; color: #fff; }
  .legs-option { padding: 12px; margin-bottom: 0; min-width: 60px; flex:1; }

  /* å¤´åƒä¸æµ·æŠ¥å±•ç¤º */
  .cute-avatar { width: 65px; height: 65px; border-radius: 50%; border: 2px solid #D8B4FE; margin: 0 auto 10px; display: block; background: #fff; object-fit: cover; }
  #posterPreview { width: 100%; max-width: 300px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: block; margin: 0 auto; border: 1px solid var(--border-glass);}
  .back-btn { font-size: 14px; color: var(--text-sub); text-align: center; margin-top: 20px; text-decoration: underline; cursor:pointer;}
</style>
</head>
<body>

  <!-- ================= æ¬¢å¿«å„¿ç«¥éŸ³ä¹ ================= -->
  <audio id="bgm" src="./xx.mp3" loop></audio>
  <div id="music-btn" class="music-btn paused" onclick="toggleMusic()">ğŸµ</div>

  <!-- ================= é¡µé¢ 01ï¼šä¸»èœå•é¡µ ================= -->
  <div id="page-main" class="page active">
    <div class="top-bar">
      <div class="brand">
        <img src="logo.png" onerror="this.src='https://via.placeholder.com/32?text=Logo'" style="height: 50px; width: 150px; border-radius: 8px; margin-right: 10px; object-fit: cover;">
      </div>
    </div>

    <h1 class="neon-title">æ˜Ÿæ²™èŒå¨ƒ<br>æ°”è´¨å¤§èµ</h1>
    <p class="subtitle">å¯»è§…å…¨æ˜Ÿæ²™æœ€æœ‰èŒƒå„¿çš„å¼€å­¦é”¦é²¤</p>
    <div style="text-align: center;"><span class="highlight-text">ï¼ˆå®Œæˆä»»æ„ 1 é¡¹æŒ‘æˆ˜ â” å¼€å­¦æ–‡å…·ç›²è¢‹å…è´¹é¢†ï¼‰</span></div>

    <!-- ç©æ³•å¡ç‰‡ 1 -->
    <div class="menu-card" onclick="navTo('page-game1')">
      <div class="menu-icon" style="background: var(--icon-purple);">ğŸ¤</div>
      <div class="menu-text">
        <h3>äº²å­é»˜å¥‘æŒ‘æˆ˜</h3>
        <p>ä¸‰ä¸ªè„‘æ´é—®é¢˜ã€‚æµ‹æµ‹å’Œå¦ˆå¦ˆçš„é»˜å¥‘æŒ‡æ•°</p>
      </div>
    </div>

    <!-- ç©æ³•å¡ç‰‡ 2 -->
    <div class="menu-card" onclick="navTo('page-game2')">
      <div class="menu-icon" style="background: var(--icon-pink);">ğŸ“¸</div>
      <div class="menu-text">
        <h3>èŒå¨ƒè¡¨æƒ…å¤§èµ</h3>
        <p>èŒå¨ƒæ¨¡ä»¿ç§€ã€‚æŠ½ç­¾è§£é”æ˜¾çœ¼åŒ…æŒ‘æˆ˜</p>
      </div>
    </div>

    <!-- ç©æ³•å¡ç‰‡ 3 -->
    <div class="menu-card" onclick="navTo('page-game3')">
      <div class="menu-icon" style="background: var(--icon-blue);">ğŸ–ï¸</div>
      <div class="menu-text">
        <h3>å®¶é•¿æ°”è´¨è¯„æµ‹</h3>
        <p>ä¸‰é“é¢˜é‰´å®šç¡¬æ ¸çˆ¸å¦ˆ</p>
      </div>
    </div>

    <div class="footer-info">
      <div style="font-size: 12px; color: #5B607A; margin-bottom: 10px;">æ´»åŠ¨æ—¶é—´ï¼š2026å¹´2æœˆ28æ—¥ - 2026å¹´3æœˆ10æ—¥</div>
      <div style="display: flex; justify-content: center; gap: 10px;">
        <div style="border: 1px solid #32364B; color: #5B607A; padding: 4px 12px; border-radius: 6px; font-size: 12px;">æ˜Ÿæ²™è¡—é“æˆæƒ</div>
        <div style="border: 1px solid #32364B; color: #5B607A; padding: 4px 12px; border-radius: 6px; font-size: 12px;">å“ç‰Œè”åŠ¨æ”¯æŒ</div>
      </div>
    </div>
  </div>

  <!-- ================= ç©æ³•ä¸€ï¼šäº²å­é»˜å¥‘æŒ‘æˆ˜ ================= -->
  <div id="page-game1" class="page">
    <h2 style="margin: 30px 0 10px; font-size: 24px; text-align:center;">äº²å­é»˜å¥‘æŒ‘æˆ˜</h2>
    <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Felix&backgroundColor=b6e3f4" class="cute-avatar" alt="å„¿ç«¥å¤´åƒ">
    <p style="color:var(--text-sub); font-size: 13px; text-align:center; margin-bottom: 20px;">ç©æ³•ï¼šç”±å¦ˆå¦ˆæé—®è®°å½•ä¸‹å­©å­çš„å›ç­”ï¼Œæ‹ç…§ä¸Šä¼ ã€‚</p>
    
    <div class="inner-card">
      <p style="color:var(--text-main); font-size: 14px; margin-bottom:10px;">Q1: å¦‚æœå¦ˆå¦ˆæœ‰é­”æ³•ï¼Œç¬¬ä¸€ä»¶äº‹æƒ³å¸¦ä½ åšä»€ä¹ˆ?</p>
      <input type="text" id="g1a1" placeholder="æ¯”å¦‚ï¼šé£åˆ°äº‘æœµä¸Š">

      <p style="color:var(--text-main); margin: 20px 0 10px; font-size: 14px;">Q2: ç»™å¦ˆå¦ˆç”»ä¸€å¼ åƒï¼Œä½ ä¼šç»™å¥¹ç”»å‡ æ¡è…¿?</p>
      <div style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px;">
        <div class="quiz-option legs-option" onclick="selectLegs('å¾ˆå¤š', this)">å¾ˆå¤š</div>
        <div class="quiz-option legs-option" onclick="selectLegs('2', this)">2 æ¡</div>
        <div class="quiz-option legs-option" onclick="selectLegs('4', this)">4 æ¡</div>
        <div class="quiz-option legs-option" onclick="selectLegs('8', this)">8 æ¡</div>
      </div>
      <input type="hidden" id="g1a2">

      <p style="color:var(--text-main); margin: 20px 0 10px; font-size: 14px;">Q3: å¦‚æœæ˜Ÿæ˜Ÿå¯ä»¥åƒï¼Œä½ è§‰å¾—æ˜¯ä»€ä¹ˆå‘³é“?</p>
      <input type="text" id="g1a3" placeholder="æ¯”å¦‚ï¼šè‰è“å‘³è·³è·³ç³–">

      <p style="color:var(--text-main); margin: 20px 0 10px; font-size: 14px;">ä¸Šä¼ å®è´é“ç…§ï¼š</p>
      <input type="file" id="photo-input1" accept="image/*" capture="environment">
    </div>
    <button class="btn" onclick="generatePoster('game1')">ç”Ÿæˆé»˜å¥‘å†™çœŸæµ·æŠ¥</button>
    <div class="back-btn" onclick="navTo('page-main')">è¿”å›ä¸»é¡µ</div>
  </div>

  <!-- ================= ç©æ³•äºŒï¼šèŒå¨ƒè¡¨æƒ…å¤§èµ ================= -->
  <div id="page-game2" class="page">
    <h2 style="margin: 30px 0 10px; font-size: 24px; text-align:center;">èŒå¨ƒè¡¨æƒ…å¤§èµ</h2>
    <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Luna&backgroundColor=ffd5dc" class="cute-avatar" alt="å„¿ç«¥å¤´åƒ">
    
    <div class="inner-card" style="text-align: center;">
      <div style="font-size: 40px; margin-bottom: 5px;">ğŸ æŠ½ç­¾æŒ‘æˆ˜</div>
      <button class="btn" style="padding:12px; font-size:16px; margin: 15px 0; background:var(--icon-pink);" onclick="drawChallenge()">ğŸ² ç‚¹å‡»æŠ½å–åŠ¨ç‰©æ¨¡ä»¿ç§€</button>
      
      <div id="challengeDisplay" style="background:rgba(255,255,255,0.05); border-radius:16px; padding:20px; min-height:120px;">
        <p style="color:#ccc; line-height: 120px; margin:0;">ğŸ‘ˆ æŠ½ä¸€ä¸ªè¯•è¯•æ‰‹æ°”ï½</p>
      </div>

      <p style="color:var(--text-main); margin: 20px 0 10px; text-align: left; font-size: 14px;">æŠ“æ‹å®è´æŒ‘æˆ˜ä¸­çš„è¡¨æƒ…/åŠ¨ä½œï¼š</p>
      <input type="file" id="photo-input2" accept="image/*" capture="environment">
    </div>
    <button class="btn" style="background: var(--icon-pink);" onclick="generatePoster('game2')">ç”Ÿæˆè¡¨æƒ…åŒ…æµ·æŠ¥</button>
    <div class="back-btn" onclick="navTo('page-main')">è¿”å›ä¸»é¡µ</div>
  </div>

  <!-- ================= ç©æ³•ä¸‰ï¼šå®¶é•¿æ°”è´¨è¯„æµ‹ ================= -->
  <div id="page-game3" class="page">
    <h2 style="margin: 30px 0; font-size: 24px; text-align:center;">ç¡¬æ ¸å®¶é•¿è¯„æµ‹</h2>
    <div style="width:100%; text-align:right; color:var(--neon-purple); font-size:14px; margin-bottom:10px; font-weight:bold;"><span id="quiz-progress">1/3</span></div>
    <div class="inner-card">
      <h3 id="quiz-q" style="margin-bottom:25px; font-size:18px; line-height:1.5; color: #fff;">é¢˜ç›®åŠ è½½ä¸­...</h3>
      <div id="quiz-options"></div>
    </div>
    <div class="back-btn" onclick="navTo('page-main')">æ”¾å¼ƒç­”é¢˜ï¼Œè¿”å›ä¸»é¡µ</div>
  </div>

  <!-- ================= ç»“æœæµ·æŠ¥å±•ç¤ºé¡µ ================= -->
  <div id="page-poster" class="page">
    <h2 id="poster-page-title" style="margin: 20px 0; font-size: 24px; text-align:center;">ç”ŸæˆæˆåŠŸ</h2>
    <img id="posterPreview" src="" alt="é•¿æŒ‰ä¿å­˜æµ·æŠ¥">
    
    <p style="color:var(--neon-purple); font-size: 16px; margin-top: 20px; font-weight: bold; text-align: center; animation: pulse 1.5s infinite;">ğŸ‘† è¯·é•¿æŒ‰ä¸Šæ–¹æµ·æŠ¥ä¿å­˜ï¼Œåˆ†äº«è‡³æœ‹å‹åœˆ</p>
    <style>@keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }</style>
    
    <!-- å¼•å¯¼å‘æœ‹å‹åœˆå’Œæ‰«ç çš„è¾…åŠ©åŒºå— -->
    <div style="background: rgba(255,255,255,0.05); border-radius: 16px; padding: 15px; margin-top: 20px; width: 100%; text-align: center; border: 1px dashed var(--border-glass);">
      <p style="color: #fff; font-size: 14px; margin-bottom: 10px; font-weight:bold;">æˆ‘ä¹Ÿè¦å‚ä¸æ¸¸æˆï¼Œé¢†å¼€å­¦æ–‡å…·ç¤¼åŒ… ğŸ</p>
      <img src="qr.png" onerror="this.src='https://via.placeholder.com/100'" style="width: 90px; height: 90px; border-radius: 8px;">
      <p style="color: var(--text-sub); font-size: 12px; margin-top: 5px;">æˆªå±å‘æœ‹å‹åœˆï¼Œé•¿æŒ‰å¯è¯†åˆ«ä¸Šæ–¹äºŒç»´ç </p>
    </div>

    <div style="width: 100%; margin-top: 20px;">
      <button class="btn" onclick="navTo('page-form')">æˆ‘å·²åˆ†äº«æœ‹å‹åœˆï¼Œå»é¢†å¥– ğŸ</button>
      <button class="btn btn-outline" onclick="navTo('page-main')">è¿”å›é¦–é¡µ</button>
    </div>
  </div>

  <!-- ================= é¢†å¥–è¡¨å•é¡µ ================= -->
  <div id="page-form" class="page">
    <h2 style="margin: 30px 0 20px; font-size: 24px; text-align:center;">é”¦é²¤ç¤¼åŒ…ç™»è®°</h2>
    <p style="color:var(--text-sub); font-size:14px; margin-bottom:20px; text-align:center;">è¯·å®Œå–„ä¿¡æ¯ï¼Œæ–¹ä¾¿è€å¸ˆä¸ºæ‚¨æ ¸é”€å¥–å“</p>
    
    <div class="inner-card">
      <input type="text" id="form-name" placeholder="ğŸ‘¤ å®è´å§“å">
      <input type="tel" id="form-age" placeholder="ğŸ‚ å®è´å¹´é¾„">
      <input type="tel" id="form-phone" placeholder="ğŸ“± å®¶é•¿æ‰‹æœºå·">
      
      <div style="position: relative;">
        <select id="form-subject" required>
          <option value="" disabled selected hidden>ğŸ¨ è¯·é€‰æ‹©æ„Ÿå…´è¶£çš„ç§‘ç›®</option>
          <option value="å°‘å„¿ç¾æœ¯">å°‘å„¿ç¾æœ¯</option>
          <option value="å°‘å„¿å£æ‰">å°‘å„¿å£æ‰</option>
          <option value="å°‘å„¿èˆè¹ˆ">å°‘å„¿èˆè¹ˆ</option>
          <option value="ä¹¦æ³•">ç¡¬ç¬”/æ¯›ç¬”ä¹¦æ³•</option>
          <option value="å…¶ä»–">å…¶ä»–</option>
        </select>
        <div style="position: absolute; right: 15px; top: 18px; color: #5B607A; pointer-events: none;">â–¼</div>
      </div>
      
      <button class="btn" onclick="submitForm()">æäº¤æ ¸é”€ä¿¡æ¯</button>
      <p style="color: #F87171; font-size: 12px; margin-top: 15px; text-align: center; line-height: 1.5;">âš ï¸ æäº¤åè¯·åŠ¡å¿…ä¿ç•™æœ‹å‹åœˆè®°å½•ï¼Œ<br>ç°åœºæ ¸é”€éœ€å‡ºç¤ºæ‰‹æœºæˆªå›¾å“¦ï¼</p>
    </div>
  </div>

  <!-- ================= æœ€ç»ˆå¯¼æµé¡µ ================= -->
  <div id="page-finish" class="page">
    <div style="text-align: center; margin-top: 6vh;"><div style="font-size: 60px; margin-bottom: 20px;">ğŸ‰</div><h2 style="font-size: 28px; margin-bottom: 10px;">ç™»è®°æˆåŠŸ</h2></div>
    <div class="inner-card" style="text-align:center; margin-top: 20px;">
      <p style="font-size:16px; font-weight:bold; color:#fff; margin-bottom:20px;">æœ€åä¸€æ­¥ï¼šæ·»åŠ è€å¸ˆå¾®ä¿¡å‘æˆªå›¾</p>
      <div style="width:180px; height:180px; background:#fff; margin:0 auto; border-radius:16px; padding:10px;">
        <img src="qr.png" onerror="this.src='https://via.placeholder.com/160'" style="width:100%; height:100%; object-fit: contain;">
      </div>
      <p style="color:var(--neon-purple); font-size: 16px; font-weight:bold; margin-top: 20px;">é•¿æŒ‰è¯†åˆ«æ·»åŠ è€å¸ˆ</p>
      <p style="color:var(--text-sub); font-size:14px; margin-top:10px; line-height:1.6;">å‘é€æš—å· <span style="color:#fff;">ã€æœ‹å‹åœˆæˆªå›¾ã€‘</span><br>å³åˆ»ä¸ºæ‚¨é”å®šå¤§ç¤¼åŒ…ï¼</p>
    </div>
  </div>

  <canvas id="posterCanvas" width="800" height="1200" style="display:none;"></canvas>

<script>
  /* ================= éŸ³ä¹æ§åˆ¶ ================= */
  const bgm = document.getElementById('bgm');
  const musicBtn = document.getElementById('music-btn');
  let musicPlayed = false;

  function toggleMusic() {
    if (bgm.paused) { bgm.play(); musicBtn.classList.remove('paused'); musicPlayed = true; } 
    else { bgm.pause(); musicBtn.classList.add('paused'); }
  }
  // å¾®ä¿¡æµè§ˆå™¨è§¦æ‘¸è‡ªåŠ¨æ’­æ”¾ Hack
  document.addEventListener('touchstart', function() {
    if(!musicPlayed) { bgm.play(); musicBtn.classList.remove('paused'); musicPlayed = true; }
  }, {once:true});

  /* ================= é¡µé¢è·¯ç”± ================= */
  function navTo(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    window.scrollTo(0,0);
    if(pageId === 'page-game3') startQuiz();
  }

  /* ================= ç©æ³•ä¸€ï¼šè…¿çš„æ•°é‡é€‰æ‹© ================= */
  function selectLegs(val, el) {
    document.getElementById('g1a2').value = val;
    document.querySelectorAll('.legs-option').forEach(opt => opt.classList.remove('selected'));
    el.classList.add('selected');
  }

  /* ================= ç©æ³•äºŒï¼šèŒå¨ƒè¡¨æƒ…å¤§èµæŠ½ç­¾ ================= */
  const challenges = [
    { title: "å¤§çŒ©çŒ©æ¶èƒ¸", desc: "ä¸€è¾¹æ¶èƒ¸ä¸€è¾¹å‘å‡º'å‘œå‘œ'å£°ï¼Œè¶Šå‡¶è¶Šå¥½ç¬‘!", icon: "ğŸ¦" },
    { title: "å°å¤©é¹…é£é£", desc: "è¸®èµ·è„šå°–ï¼ŒåŒæ‰‹åšç¿…è†€ï¼Œä¼˜é›…ä¸­å¸¦ç‚¹æç¬‘", icon: "ğŸ¦¢" },
    { title: "ä¼é¹…æ‘‡æ‘‡æ™ƒæ™ƒ", desc: "ä¸¤æ‰‹è´´ç´§èº«ä½“ï¼Œå·¦å³æ‘‡æ‘†èµ°ï¼Œæœ€å¥½æ’åˆ°å¦ˆå¦ˆæ€€é‡Œ", icon: "ğŸ§" },
    { title: "å°èƒèŸ¹æ¨ªç€èµ°", desc: "æ¨ªç€èµ°ï¼Œä¸¤åªæ‰‹åšé’³å­", icon: "ğŸ¦€" },
    { title: "è¡¨æƒ…åŒ…äº”è¿æ‹", desc: "10 ç§’å†…æ ¹æ®æç¤ºå¿«é€Ÿè½¬æ¢ 5 ä¸ªè¡¨æƒ…ï¼šå¼€å¿ƒ-ç”Ÿæ°”-æƒŠè®¶-å§”å±ˆ-å‘å‘†-å¾—æ„-å›°äº†-åƒé¥±äº†-çœ‹è§å†°æ·‡æ·‹", icon: "ğŸ¤ª" }
  ];
  let currentChallenge = null;

  function drawChallenge() {
    const displayDiv = document.getElementById('challengeDisplay');
    displayDiv.innerHTML = `<h3 style='color:#fff; font-size:20px; line-height: 80px;'>ğŸ² æŠ½å–ä¸­...</h3>`;
    setTimeout(() => {
      currentChallenge = challenges[Math.floor(Math.random() * challenges.length)];
      displayDiv.innerHTML = `
        <div style="font-size:50px; margin-bottom:10px;">${currentChallenge.icon}</div>
        <p style="color: var(--neon-purple); font-size: 22px; font-weight:bold; margin-bottom:5px;">${currentChallenge.title}</p>
        <p style="color: #fff; font-size: 14px; line-height:1.5;">${currentChallenge.desc}</p>
      `;
    }, 600);
  }

  /* ================= æµ·æŠ¥ç”Ÿæˆå¼•æ“ ================= */
  function generatePoster(gameType) {
    let fileInput, posterTitle = "", quoteText = "", bottomHighlight = "";
    
    // ----------- ç©æ³•ä¸€ é€»è¾‘ -----------
    if (gameType === 'game1') {
      fileInput = document.getElementById('photo-input1').files[0];
      const q1 = document.getElementById('g1a1').value.trim() || "æ²¡æƒ³å¥½";
      const q2 = document.getElementById('g1a2').value;
      const q3 = document.getElementById('g1a3').value.trim() || "ç§˜å¯†";
      if (!q2) { alert("è¯·ç»™å¦ˆå¦ˆé€‰å‡ æ¡è…¿ï½"); return; }
      
      // 1. éšæœºæµ·æŠ¥æ ‡é¢˜
      const titles = ["æ˜Ÿæ²™æœ€æœ‰åˆ›æ„èŒå¨ƒ", "æˆ‘æ˜¯é‡‘å¥å°è¾¾äºº", "è„‘æ´æ¸…å¥‡å°è¶…äºº", "æˆ‘æ˜¯åˆ›æ„å°é©¬è¾¾"];
      posterTitle = titles[Math.floor(Math.random() * titles.length)];
      
      // 2. éšæœºç­”æ¡ˆç”Ÿæˆ
      const answers = [
        `é­”ä»™å ¡å¦ˆå¦ˆçš„æ‰“å¡æ—¥å¸¸â€”${q1}`,
        `æˆ‘çš„å¦ˆå¦ˆæ˜¯è¶…çº§æ— æ•Œå®‡å®™æœ€é…·å¦ˆå¦ˆï¼Œå› ä¸ºå¥¹æœ‰${q2}æ¡è…¿`,
        `æ˜Ÿæ˜Ÿå‘€æ˜Ÿæ˜Ÿï¼ŒåŸæ¥ä½ æ˜¯${q3}å‘³çš„`
      ];
      quoteText = answers[Math.floor(Math.random() * answers.length)];
      
      // 3. åº•éƒ¨å°å­—
      bottomHighlight = "å­©å­çš„æƒ³æ³•è·Ÿå¦ˆå¦ˆä¸€æ ·å—ï¼ŒçœŸæ˜¯æœ‰åˆ›æ„å‘€ã€‚";
      document.getElementById('poster-page-title').innerText = "ç”ŸæˆæˆåŠŸ";

    // ----------- ç©æ³•äºŒ é€»è¾‘ -----------
    } else if (gameType === 'game2') {
      fileInput = document.getElementById('photo-input2').files[0];
      if (!currentChallenge) { alert("è¯·å…ˆç‚¹å‡»æŠ½ç­¾ï¼ŒæŠ½å–ä¸€ä¸ªæŒ‘æˆ˜å§ï¼"); return; }
      
      posterTitle = "èŒå¨ƒæ¼”æŠ€æ´¾";
      quoteText = `æ­å–œå®è´æˆåŠŸæŒ‘æˆ˜â€œ${currentChallenge.title}â€æ¼”æŠ€ç‚¸è£‚ï¼Œç¬‘ç¿»å…¨åœºã€‚`;
      bottomHighlight = ""; // ç©æ³•äºŒä¸éœ€è¦é¢å¤–é«˜å…‰å­—
      document.getElementById('poster-page-title').innerText = "æ­å–œï¼æŒ‘æˆ˜æˆåŠŸï¼";
    }

    if (!fileInput) { alert("è¯·å…ˆä¸Šä¼ ä¸€å¼ ç…§ç‰‡å“¦ï¼"); return; }

    const reader = new FileReader();
    reader.onload = function(e) {
      const canvas = document.getElementById('posterCanvas');
      const ctx = canvas.getContext('2d');
      
      // æš—é»‘æ¸å˜èƒŒæ™¯
      const grad = ctx.createLinearGradient(0,0,0,1200);
      grad.addColorStop(0, '#1A1C35'); grad.addColorStop(1, '#0C0E1F');
      ctx.fillStyle = grad; ctx.fillRect(0,0,800,1200);

      const img = new Image();
      img.src = e.target.result;
      img.onload = () => {
        // ç›¸æ¡†å¤–å‘å…‰
        ctx.shadowColor = gameType === 'game1' ? '#B258FF' : '#F43F5E'; ctx.shadowBlur = 30;
        ctx.fillStyle = '#fff'; 
        ctx.beginPath(); ctx.roundRect(80, 180, 640, 640, 40); ctx.fill();
        ctx.shadowBlur = 0;

        // å±…ä¸­è£å‰ªç»˜åˆ¶ç…§ç‰‡
        ctx.save();
        ctx.beginPath(); ctx.roundRect(80, 180, 640, 640, 40); ctx.clip();
        let scale = Math.max(640 / img.width, 640 / img.height);
        let sw = 640 / scale, sh = 640 / scale;
        let sx = (img.width - sw) / 2, sy = (img.height - sh) / 2;
        ctx.drawImage(img, sx, sy, sw, sh, 80, 180, 640, 640);
        ctx.restore();

        // ç»˜åˆ¶é¡¶éƒ¨æ ‡é¢˜
        ctx.fillStyle = "#fff"; ctx.font = "bold 56px 'PingFang SC', sans-serif"; ctx.textAlign = "center";
        ctx.fillText(posterTitle, 400, 110);
        
        // ç»˜åˆ¶ä¾§è¾¹ Emoji (ç‚¹èµğŸ‘ / å¥–æ¯ğŸ†)
        ctx.font = "60px sans-serif";
        if(gameType === 'game1') ctx.fillText("ğŸ‘", 400, 770); 
        else ctx.fillText("ğŸ†", 680, 780); 

        // åº•éƒ¨æ–‡å­—èƒŒæ¿
        ctx.fillStyle = "rgba(255,255,255,0.1)";
        ctx.beginPath(); ctx.roundRect(50, 860, 700, 160, 20); ctx.fill();
        
        // ç»˜åˆ¶éšæœºç­”æ¡ˆ (è‡ªåŠ¨æ¢è¡Œå¤„ç†)
        ctx.fillStyle = gameType === 'game1' ? "#D8B4FE" : "#FDA4AF";
        ctx.font = "bold 28px 'PingFang SC', sans-serif";
        wrapText(ctx, quoteText, 400, 915, 650, 40);

        // ç»˜åˆ¶é¢å¤–å°å­— & å®˜æ–¹è®¤è¯
        ctx.fillStyle = "#fff"; ctx.font = "20px 'PingFang SC'";
        if(bottomHighlight) ctx.fillText(bottomHighlight, 400, 1070);
        
        ctx.fillStyle = "#8E93A8"; ctx.font = "bold 32px 'PingFang SC'";
        ctx.fillText("â€”â€” æ©˜å­è‰ºæœ¯å®˜æ–¹è®¤è¯ â€”â€”", 400, 1130);

        document.getElementById('posterPreview').src = canvas.toDataURL('image/jpeg');
        navTo('page-poster');
      }
    }
    reader.readAsDataURL(fileInput);
  }

  // è¾…åŠ©å‡½æ•°ï¼šCanvas è‡ªåŠ¨æ¢è¡Œä¸”å‚ç›´å±…ä¸­
  function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
    let words = text.split(''), line = '', lines = [];
    for (let n = 0; n < words.length; n++) {
      let testLine = line + words[n];
      let metrics = ctx.measureText(testLine);
      if (metrics.width > maxWidth && n > 0) { lines.push(line); line = words[n]; } 
      else { line = testLine; }
    }
    lines.push(line);
    // è°ƒæ•´ Y è½´ä½¿æ•´ä½“å±…ä¸­
    let startY = y - ((lines.length - 1) * lineHeight) / 2;
    for (let i = 0; i < lines.length; i++) { ctx.fillText(lines[i], x, startY + (i * lineHeight)); }
  }

  /* ================= ç©æ³•ä¸‰ï¼šå®¶é•¿æ°”è´¨è¯„æµ‹ ================= */
  const quizData = [
    { q: "å‘¨æœ«å¸¦å­©å­å‡ºå»ç©ï¼Œä½ é€šå¸¸ä¼šï¼Ÿ", options: [{t:"åšè¯¦ç»†æ”»ç•¥ï¼ŒæŒ‰è®¡åˆ’èµ°", s:"A"}, {t:"éšå«éšèµ°ï¼Œä¸»æ‰“ä¸€ä¸ªéšæ€§", s:"B"}, {t:"ç»™å¨ƒæŠ¥ä¸ªä½“éªŒè¯¾ï¼Œæˆ‘åœ¨æ—è¾¹å–å’–å•¡", s:"C"}] },
    { q: "å­©å­å¼„è„äº†åˆšä¹°çš„æ–°è¡£æœï¼Œä½ çš„ååº”ï¼Ÿ", options: [{t:"å´©æºƒï¼é©¬ä¸Šè„±ä¸‹æ¥æ´—", s:"A"}, {t:"èµ¶ç´§æ‹ç…§å‘æœ‹å‹åœˆ", s:"B"}, {t:"è„å°±è„å§ï¼Œç©å¾—å¼€å¿ƒæœ€é‡è¦", s:"C"}] },
    { q: "ç»™å­©å­è¾…å¯¼ä½œä¸šæ—¶ï¼Œä½ çš„çŠ¶æ€æ˜¯ï¼Ÿ", options: [{t:"æ¯æ…ˆå­å­ï¼Œè€å¿ƒè®²è§£", s:"A"}, {t:"é¸¡é£ç‹—è·³ï¼Œéšæ—¶çˆ†å‘", s:"B"}, {t:"ç›´æ¥äº¤ç»™çˆ¸çˆ¸/è¾…å¯¼ç­", s:"C"}] }
  ];
  let currentQuiz = 0; let scores = { A:0, B:0, C:0 };

  function startQuiz() { currentQuiz = 0; scores = {A:0, B:0, C:0}; renderQuiz(); }

  function renderQuiz() {
    document.getElementById('quiz-progress').innerText = `${currentQuiz + 1} / 3`;
    document.getElementById('quiz-q').innerText = quizData[currentQuiz].q;
    let optsHtml = "";
    quizData[currentQuiz].options.forEach((opt) => {
      optsHtml += `<div class="quiz-option" onclick="selectOption('${opt.s}')">${opt.t}</div>`;
    });
    document.getElementById('quiz-options').innerHTML = optsHtml;
  }

  function selectOption(scoreType) {
    scores[scoreType]++;
    setTimeout(() => {
      if(currentQuiz < 2) { currentQuiz++; renderQuiz(); } 
      else { generateQuizResult(); }
    }, 200);
  }

  function generateQuizResult() {
    let max = 'A';
    if(scores.B > scores[max]) max = 'B';
    if(scores.C > scores[max]) max = 'C';
    let res = max === 'A' ? "å…¨èƒ½æ“å¿ƒå‹è€å¦ˆ" : max === 'B' ? "å¿«ä¹æ”¾å…»å‹ç¡¬æ ¸çˆ¸å¦ˆ" : "ä½›ç³»èººå¹³å‹å®¶é•¿";

    const canvas = document.getElementById('posterCanvas');
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#1A1C35'; ctx.fillRect(0,0,800,1200);
    
    ctx.fillStyle = '#fff'; ctx.font = "bold 60px sans-serif"; ctx.textAlign = "center";
    ctx.fillText("ç¡¬æ ¸å®¶é•¿é‰´å®šæŠ¥å‘Š", 400, 300);
    ctx.fillStyle = "#B258FF"; ctx.font = "bold 70px sans-serif";
    ctx.fillText(res, 400, 600);
    ctx.fillStyle = "#8E93A8"; ctx.font = "bold 32px sans-serif";
    ctx.fillText("â€”â€” æ©˜å­è‰ºæœ¯å®˜æ–¹è®¤è¯ â€”â€”", 400, 1050);
    
    document.getElementById('poster-page-title').innerText = "ç”ŸæˆæˆåŠŸ";
    document.getElementById('posterPreview').src = canvas.toDataURL('image/jpeg');
    navTo('page-poster');
  }

  /* ================= æäº¤è¡¨å• (é£ä¹¦ Webhook) ================= */
  function submitForm() {
    const name = document.getElementById('form-name').value.trim();
    const age = document.getElementById('form-age').value.trim();
    const phone = document.getElementById('form-phone').value.trim();
    const subject = document.getElementById('form-subject').value;

    if(!name || !age || phone.length < 11 || !subject) { alert("è¯·æ­£ç¡®å®Œæ•´åœ°å¡«å†™æ‰€æœ‰ä¿¡æ¯å“¦~"); return; }

    const FEISHU_WEBHOOK_URL = "https://open.feishu.cn/open-apis/bot/v2/hook/ä½ çš„çœŸå®ID";
    const btn = document.querySelector('#page-form .btn');
    const oldText = btn.innerText;
    btn.innerText = "æ•°æ®å†™å…¥ä¸­..."; btn.disabled = true;

    fetch(FEISHU_WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ "name": name, "age": age, "phone": phone, "subject": subject })
    })
    .then(response => {
      if (response.ok) navTo('page-finish');
      else { alert("ç½‘ç»œæ‹¥æŒ¤ï¼Œè¯·é‡è¯•ï¼"); btn.innerText = oldText; btn.disabled = false; }
    })
    .catch(error => {
      // âš ï¸ æµ‹è¯•é˜¶æ®µè‹¥æ— é£ä¹¦æ¥å£ï¼Œå¯å–æ¶ˆæ³¨é‡Šç›´æ¥è·³è½¬
      navTo('page-finish'); 
      // alert("æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œï¼"); btn.innerText = oldText; btn.disabled = false;
    });
  }

  /* ä½ç‰ˆæœ¬æµè§ˆå™¨ Canvas roundRect å…¼å®¹ */
  if(!CanvasRenderingContext2D.prototype.roundRect) {
    CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
      if (w < 2 * r) r = w / 2; if (h < 2 * r) r = h / 2;
      this.moveTo(x + r, y); this.lineTo(x + w - r, y); this.quadraticCurveTo(x + w, y, x + w, y + r);
      this.lineTo(x + w, y + h - r); this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
      this.lineTo(x + r, y + h); this.quadraticCurveTo(x, y + h, x, y + h - r);
      this.lineTo(x, y + r); this.quadraticCurveTo(x, y, x + r, y); this.closePath(); return this;
    };
  }
</script>
</body>
</html>