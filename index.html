<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>萌娃气质大赏</title>
  <script src="poster.js"></script>
  <style>
    /* 你的样式 */
  </style>
</head>
<body>
  <canvas id="posterCanvas" width="600" height="800" style="display:none;"></canvas>
  <video id="camera" autoplay playsinline></video>
  <div id="question">当前题目：最萌的一句口头禅？</div>
  <button id="photoBtn">拍照生成海报</button>
  <canvas id="posterCanvas" width="600" height="800" style="display:none;"></canvas>
  <img id="posterImage" style="width:100%; margin-top:20px; display:none;" />
  <script src="poster.js"></script>
  <script>
    // 调用后置摄像头
    async function initCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: { exact: 'environment' } },
          audio: false
        });
        document.getElementById('camera').srcObject = stream;
      } catch (err) {
        console.warn('强制后置失败，尝试环境优先', err);
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: 'environment' },
            audio: false
          });
          document.getElementById('camera').srcObject = stream;
        } catch (e) {
          alert('无法访问摄像头，请检查权限');
        }
      }
    }
    initCamera();

    // 拍照并生成海报
    document.getElementById('photoBtn').addEventListener('click', () => {
      const video = document.getElementById('camera');
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext('2d').drawImage(video, 0, 0);
      const photoDataURL = canvas.toDataURL('image/jpeg');

      // 调用你的 drawPoster（需提前定义）
      drawPoster('posterCanvas', {
        avatar: photoDataURL,
        title: '萌娃金句',
        logo: 'logo.png',
        qr: 'qr.png'
      }, (posterDataURL) => {
        const img = document.getElementById('posterImage');
        img.src = posterDataURL;
        img.style.display = 'block';
        // 可以隐藏视频，显示海报
      });
    });
  </script>
</body>
</html>