<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <!-- è§†å£è®¾ç½®ï¼šç¦æ­¢ç¼©æ”¾ï¼Œé€‚é…å…¨é¢å± -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>èŒå¨ƒæ°”è´¨å¤§èµ</title>
  <style>
    /* åŸºç¡€é‡ç½® */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;           /* ç”± JS åŠ¨æ€è®¾ç½® --vh æ¥æ§åˆ¶å®é™…é«˜åº¦ */
      overflow: hidden;
      background: #fff5ec;
      font-family: sans-serif;
    }

    /* é¡µé¢å®¹å™¨ï¼šflex åˆ—å¸ƒå±€ï¼Œå æ»¡è§†å£ */
    .page {
      display: flex;
      flex-direction: column;
      height: 100%;           /* ç»§æ‰¿ body é«˜åº¦ */
      width: 100%;
      position: relative;
    }

    /* é¡¶éƒ¨åŒºåŸŸ (åŒ…å«æ ‡é¢˜å’Œé—®é¢˜å¡ç‰‡) */
    .header {
      flex-shrink: 0;
      padding-top: max(env(safe-area-inset-top), 20px);
      text-align: center;
    }

    .title {
      font-size: 28px;
      color: #ff6a00;
      font-weight: bold;
      margin: 0 16px;
      line-height: 1.3;
    }

    .question {
      width: 88%;
      background: #fff;
      border-radius: 18px;
      padding: 18px;
      font-size: 20px;
      box-shadow: 0 6px 18px rgba(0,0,0,.1);
      margin: 16px auto 0;
      color: #333;
      word-break: break-word;
    }

    /* ä¸­é—´å†…å®¹åŒºï¼šå æ®å‰©ä½™ç©ºé—´ï¼Œå‚ç›´å±…ä¸­å†…å®¹ */
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      min-height: 0;          /* é˜²æ­¢ flex å­é¡¹æº¢å‡º */
      padding: 10px 0;
    }

    /* ç”Ÿæˆçš„æµ·æŠ¥å›¾ç‰‡ */
    #posterImage {
      width: 90%;
      max-height: 60vh;
      object-fit: contain;
      display: none;
      border-radius: 24px;
      box-shadow: 0 8px 24px rgba(0,0,0,.15);
      margin-bottom: 16px;
    }

    /* æç¤ºæ–‡å­— */
    #tip {
      font-size: 16px;
      color: #ff6a00;
      background: rgba(255,255,255,0.9);
      padding: 8px 20px;
      border-radius: 40px;
      display: none;
      margin-top: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,.05);
    }

    /* åº•éƒ¨æ“ä½œåŒº */
    .footer {
      flex-shrink: 0;
      padding-bottom: max(env(safe-area-inset-bottom), 20px);
      text-align: center;
    }

    /* è‡ªå®šä¹‰æ‹ç…§æŒ‰é’®ï¼ˆéšè—åŸå§‹ inputï¼Œç”¨ label ç¾åŒ–ï¼‰ */
    .camera-label {
      display: inline-block;
      background: #ff7a00;
      color: #fff;
      font-size: 20px;
      font-weight: 500;
      padding: 16px 40px;
      border-radius: 50px;
      box-shadow: 0 4px 12px rgba(255,122,0,0.4);
      cursor: pointer;
      transition: transform 0.1s ease;
    }

    .camera-label:active {
      transform: scale(0.97);
    }

    /* éšè—åŸå§‹æ–‡ä»¶è¾“å…¥ */
    #cameraInput {
      position: absolute;
      width: 1px;
      height: 1px;
      opacity: 0;
      pointer-events: none;
    }

    /* éšè—ç”»å¸ƒ */
    #posterCanvas {
      display: none;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="header">
      <div class="title">æ©˜å­è‰ºæœ¯ Â· èŒå¨ƒé‡‘å¥æŒ‘æˆ˜</div>
      <div id="question" class="question"></div>
    </div>

    <div class="content">
      <img id="posterImage" alt="ä½ çš„ä¸“å±æµ·æŠ¥">
      <div id="tip">ğŸ‘‡ é•¿æŒ‰ä¿å­˜æµ·æŠ¥ â†’ å‘æœ‹å‹åœˆé¢†å–ç¤¼åŒ…</div>
    </div>

    <div class="footer">
      <!-- åŸå§‹æ–‡ä»¶è¾“å…¥ï¼šcapture="environment" å¼ºåˆ¶åç½®æ‘„åƒå¤´ -->
      <input type="file" id="cameraInput" accept="image/*" capture="environment">
      <!-- ç¾åŒ–åçš„æŒ‰é’® -->
      <label for="cameraInput" class="camera-label">ğŸ“¸ æ‹ç…§ç”Ÿæˆæµ·æŠ¥</label>
    </div>
  </div>

  <!-- éšè—çš„ç”»å¸ƒï¼Œç”¨äºç»˜åˆ¶æµ·æŠ¥ -->
  <canvas id="posterCanvas" width="800" height="1200" style="display:none;"></canvas>

  <script src="poster.js"></script>
  <script>
    (function() {
      // ===== åŠ¨æ€è®¡ç®—è§†å£é«˜åº¦ï¼ˆè§£å†³ç§»åŠ¨ç«¯åœ°å€æ é—®é¢˜ï¼‰ =====
      function setRealVH() {
        let vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
        // åŒæ—¶è®¾ç½® body é«˜åº¦ä¸º 100% ä¾èµ– --vhï¼Ÿæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¾ç½® body é«˜åº¦ä¸º innerHeight
        // ä½†æœ€ç®€å•ï¼šç”¨ --vh æ„å»º height: calc(var(--vh, 1vh) * 100)
        // ä½†ä¸Šé¢ CSS ä¸­ body ç”¨çš„æ˜¯ height: 100%ï¼Œä¾èµ–äºçˆ¶å…ƒç´  htmlã€‚html é«˜åº¦é»˜è®¤æ˜¯è§†å£ï¼Œä½†å¯èƒ½å—æ»šåŠ¨æ¡å½±å“ã€‚
        // ä¸ºäº†ä¿è¯ç²¾ç¡®ï¼Œå¯ä»¥åœ¨ body ä¸Šä½¿ç”¨ height: calc(var(--vh, 1vh) * 100)
        document.body.style.height = `calc(var(--vh, 1vh) * 100)`;
      }
      setRealVH();
      window.addEventListener('resize', setRealVH);
      window.addEventListener('orientationchange', setRealVH);

      // ===== éšæœºé—®é¢˜ =====
      const questions = [
        "å¦‚æœå¦ˆå¦ˆæœ‰é­”æ³•ï¼Œç¬¬ä¸€ä»¶äº‹æƒ³å¸¦ä½ åšä»€ä¹ˆï¼Ÿ",
        "ç»™å¦ˆå¦ˆç”»ä¸€å¼ åƒï¼Œä½ ä¼šç»™å¥¹ç”»å‡ æ¡è…¿ï¼Ÿ",
        "å¦‚æœæ˜Ÿæ˜Ÿå¯ä»¥åƒï¼Œä½ è§‰å¾—æ˜¯ä»€ä¹ˆå‘³é“ï¼Ÿ",
        "ç”¨ä¸‰ä¸ªè¯å½¢å®¹å¦ˆå¦ˆçš„ç¬‘",
        "çˆ¸çˆ¸å’Œè¶…äººè°æ›´å‰å®³ï¼Ÿ"
      ];
      const currentQuestion = questions[Math.floor(Math.random() * questions.length)];
      document.getElementById('question').innerText = currentQuestion;

      // ===== æ‹ç…§åç”Ÿæˆæµ·æŠ¥ =====
      const cameraInput = document.getElementById('cameraInput');
      const posterImage = document.getElementById('posterImage');
      const tip = document.getElementById('tip');

      cameraInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(evt) {
          // è°ƒç”¨ poster.js ä¸­çš„ drawPoster
          drawPoster('posterCanvas', {
            avatar: evt.target.result,
            title: currentQuestion,
            logo: 'logo.png',   // å¦‚æœæœ‰ logo å›¾ç‰‡ï¼Œè¯·æ”¾åœ¨åŒç›®å½•
            qr: 'qr.png'         // å¦‚æœæœ‰äºŒç»´ç ï¼Œè¯·æ”¾åœ¨åŒç›®å½•
          }, function(posterUrl) {
            posterImage.src = posterUrl;
            posterImage.style.display = 'block';
            tip.style.display = 'block';

            // å¯é€‰ï¼šè‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨æ˜¾ç¤ºæµ·æŠ¥
            setTimeout(() => {
              window.scrollTo({
                top: document.body.scrollHeight,
                behavior: 'smooth'
              });
            }, 100);
          });
        };
        reader.readAsDataURL(file);

        // æ¸…ç©º input ä»¥ä¾¿å†æ¬¡é€‰æ‹©åŒä¸€æ–‡ä»¶æ—¶èƒ½è§¦å‘ change
        cameraInput.value = '';
      });
    })();
  </script>
  <!-- å¦‚æœéœ€è¦è°ƒè¯•ï¼Œå¯å–æ¶ˆä¸‹ä¸€è¡Œçš„æ³¨é‡Šä»¥å¯ç”¨ vConsole -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/vconsole"></script><script>new VConsole();</script> -->
</body>
</html>