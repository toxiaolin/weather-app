<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<!-- æ²‰æµ¸å¼å…¨å±ä¸é˜²ç¼©æ”¾ Meta æ ‡ç­¾ -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="format-detection" content="telephone=no">
<meta name="theme-color" content="#13142B">
<title>æ˜Ÿæ²™èŒå¨ƒå¤§èµ</title>
<style>
  /* ================= æ ¸å¿ƒæš—é»‘ä¸»é¢˜å˜é‡ ================= */
  :root {
    --bg-dark: #13142B;
    --bg-card: rgba(255, 255, 255, 0.06);
    --border-glass: rgba(255, 255, 255, 0.12);
    --neon-purple: #B258FF;
    --text-main: #FFFFFF;
    --text-sub: #8E93A8;
    --icon-purple: linear-gradient(135deg, #A855F7 0%, #7E22CE 100%);
    --icon-pink: linear-gradient(135deg, #F43F5E 0%, #BE123C 100%);
    --icon-blue: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, sans-serif; -webkit-tap-highlight-color: transparent; }
  
  html, body {
    overscroll-behavior-y: none; 
    background: var(--bg-dark); color: var(--text-main); overflow-x: hidden;
    background-image: radial-gradient(circle at 50% -20%, #2A2155 0%, var(--bg-dark) 60%);
    min-height: 100vh;
  }

  .page { display: none; padding: env(safe-area-inset-top) 20px env(safe-area-inset-bottom); flex-direction: column; align-items: center; width: 100%; min-height: 100vh; }
  .page.active { display: flex; animation: fadeIn 0.4s ease forwards; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

  /* ================= éŸ³ä¹æŒ‰é’® ================= */
  .music-btn {
    position: fixed; top: max(20px, env(safe-area-inset-top)); right: 20px; width: 36px; height: 36px;
    background: rgba(255,255,255,0.1); border-radius: 50%; display: flex;
    justify-content: center; align-items: center; font-size: 18px; z-index: 999;
    animation: spin 3s linear infinite; cursor: pointer; border: 1px solid var(--border-glass);
  }
  .music-btn.paused { animation-play-state: paused; opacity: 0.5; }
  @keyframes spin { 100% { transform: rotate(360deg); } }

  /* ================= é¡¶éƒ¨å¯¼èˆªä¸æ ‡é¢˜ ================= */
  .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; width: 100%; }
  .brand { display: flex; align-items: center; font-weight: 900; font-size: 16px; letter-spacing: 1px;}
  .neon-title { font-size: 44px; font-weight: 900; text-align: center; margin-top: 2vh; margin-bottom: 15px; line-height: 1.2; text-shadow: 0 0 10px rgba(178, 88, 255, 0.8), 0 0 20px rgba(178, 88, 255, 0.5); }
  .subtitle { font-size: 14px; color: var(--text-sub); margin-bottom: 10px; text-align: center; letter-spacing: 1px;}
  .highlight-text { font-size: 13px; color: #D8B4FE; font-weight: bold; background: rgba(178,88,255,0.1); padding: 6px 16px; border-radius: 20px; display: inline-block; margin-bottom: 30px;}

  /* ================= èœå•å¡ç‰‡ ================= */
  .menu-card { background: var(--bg-card); border: 1px solid var(--border-glass); border-radius: 24px; padding: 20px; width: 100%; display: flex; align-items: center; margin-bottom: 16px; backdrop-filter: blur(10px); cursor: pointer; transition: 0.2s; }
  .menu-card:active { transform: scale(0.96); }
  .menu-icon { width: 65px; height: 65px; border-radius: 18px; display: flex; justify-content: center; align-items: center; font-size: 30px; margin-right: 18px; color: #fff; }
  .menu-text { flex: 1; }
  .menu-text h3 { font-size: 20px; font-weight: bold; margin-bottom: 5px; color: #fff; }
  .menu-text p { font-size: 12px; color: var(--text-sub); line-height: 1.4; }
  
  .footer-info { margin-top: auto; padding-top: 4vh; text-align: center; width: 100%; padding-bottom: 30px;}
  .inner-card { background: var(--bg-card); border: 1px solid var(--border-glass); border-radius: 20px; padding: 25px 20px; width: 100%; margin-bottom: 20px; backdrop-filter: blur(10px); }
  
  .btn { background: var(--icon-purple); color: #fff; border: none; padding: 16px; border-radius: 30px; font-size: 18px; font-weight: bold; width: 100%; text-align: center; cursor: pointer; margin-top: 10px; }
  .btn:active { transform: scale(0.95); }
  .btn-outline { background: transparent; border: 1px solid var(--neon-purple); color: #D8B4FE; }
  
  /* ================= è¡¨å•ä¸é€‰é¡¹ ================= */
  input[type="text"], input[type="tel"], input[type="file"], select { width: 100%; padding: 16px; border: 1px solid var(--border-glass); border-radius: 12px; margin-bottom: 15px; background: rgba(0,0,0,0.2); font-size: 16px; color: #fff; outline: none; -webkit-appearance: none; appearance: none;}
  input::placeholder { color: #5B607A; }
  select:invalid { color: #5B607A; }
  select option { background: #13142B; color: #fff; }
  .quiz-option { background: rgba(255,255,255,0.05); border: 1px solid var(--border-glass); padding: 16px; border-radius: 12px; margin-bottom: 12px; font-size: 16px; text-align: center; cursor: pointer; color: #ccc; transition: 0.2s;}
  .quiz-option.selected { border-color: var(--neon-purple); background: rgba(178, 88, 255, 0.15); font-weight: bold; color: #fff; }
  .legs-option { padding: 12px; margin-bottom: 0; min-width: 60px; flex:1; }

  /* å¤´åƒä¸æµ·æŠ¥å±•ç¤º */
  .cute-avatar { width: 65px; height: 65px; border-radius: 50%; border: 2px solid #D8B4FE; margin: 0 auto 10px; display: block; background: #fff; object-fit: cover; }
  #posterPreview { width: 100%; max-width: 320px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: block; margin: 0 auto; border: 1px solid var(--border-glass);}
  .back-btn { font-size: 14px; color: var(--text-sub); text-align: center; margin-top: 20px; margin-bottom: 20px; text-decoration: underline; cursor:pointer;}
</style>
</head>
<body>

  <!-- ================= æ¬¢å¿«å„¿ç«¥éŸ³ä¹ ================= -->
  <audio id="bgm" src="https://downsc.chinaz.net/Files/DownLoad/sound1/202003/12611.mp3" loop></audio>
  <div id="music-btn" class="music-btn paused" onclick="toggleMusic()">ğŸµ</div>

  <!-- ================= é¡µé¢ 01ï¼šä¸»èœå•é¡µ ================= -->
  <div id="page-main" class="page active">
    <div class="top-bar">
      <div class="brand">
        <img src="logo.png" onerror="this.src='https://via.placeholder.com/150x50?text=Logo'" style="height: 50px; border-radius: 8px; margin-right: 10px; object-fit: cover;">
      </div>
    </div>

    <h1 class="neon-title">æ˜Ÿæ²™èŒå¨ƒ<br>æ°”è´¨å¤§èµ</h1>
    <p class="subtitle">å¯»æ‰¾å…¨æ˜Ÿæ²™æœ€ç¾èŒå¨ƒ</p>
    <div style="text-align: center;"><span class="highlight-text">ï¼ˆå®Œæˆä»»æ„ 1 é¡¹æŒ‘æˆ˜ â” å¼€å­¦æ–‡å…·ç›²è¢‹å…è´¹é¢†ï¼‰</span></div>

    <!-- ç©æ³•å¡ç‰‡ 1 -->
    <div class="menu-card" onclick="navTo('page-game1')">
      <div class="menu-icon" style="background: var(--icon-purple);">ğŸ¤</div>
      <div class="menu-text">
        <h3>äº²å­é»˜å¥‘æŒ‘æˆ˜</h3>
        <p>ä¸‰ä¸ªè„‘æ´é—®é¢˜Â·æµ‹æµ‹å’Œå¦ˆå¦ˆçš„é»˜å¥‘æŒ‡æ•°</p>
      </div>
    </div>

    <!-- ç©æ³•å¡ç‰‡ 2 -->
    <div class="menu-card" onclick="navTo('page-game2')">
      <div class="menu-icon" style="background: var(--icon-pink);">ğŸ“¸</div>
      <div class="menu-text">
        <h3>èŒå¨ƒè¡¨æƒ…å¤§èµ</h3>
        <p>èŒå¨ƒæ¨¡ä»¿ç§€Â·æŠ½ç­¾è§£é”æ˜¾çœ¼åŒ…æŒ‘æˆ˜</p>
      </div>
    </div>

    <!-- ç©æ³•å¡ç‰‡ 3 -->
    <div class="menu-card" onclick="navTo('page-game3')">
      <div class="menu-icon" style="background: var(--icon-blue);">ğŸ–ï¸</div>
      <div class="menu-text">
        <h3>å®¶é•¿æ°”è´¨è¯„æµ‹</h3>
        <p>ä¸‰é“é¢˜é‰´å®šç¡¬æ ¸çˆ¸å¦ˆ</p>
      </div>
    </div>

    <div class="footer-info">
      <div style="font-size: 12px; color: #5B607A; margin-bottom: 10px;">æ´»åŠ¨æ—¶é—´ï¼š2026å¹´2æœˆ28æ—¥ - 2026å¹´3æœˆ10æ—¥</div>
      <div style="display: flex; justify-content: center; gap: 10px;">
        <div style="border: 1px solid #32364B; color: #5B607A; padding: 4px 12px; border-radius: 6px; font-size: 12px;">æ˜Ÿæ²™è¡—é“æˆæƒ</div>
        <div style="border: 1px solid #32364B; color: #5B607A; padding: 4px 12px; border-radius: 6px; font-size: 12px;">å“ç‰Œè”åŠ¨æ”¯æŒ</div>
      </div>
    </div>
  </div>

  <!-- ================= ç©æ³•ä¸€ï¼šäº²å­é»˜å¥‘æŒ‘æˆ˜ ================= -->
  <div id="page-game1" class="page">
    <h2 style="margin: 30px 0 10px; font-size: 24px; text-align:center;">äº²å­é»˜å¥‘æŒ‘æˆ˜</h2>
    <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Felix&backgroundColor=b6e3f4" class="cute-avatar" alt="å„¿ç«¥å¤´åƒ">
    <p style="color:var(--text-sub); font-size: 13px; text-align:center; margin-bottom: 20px;">ç©æ³•ï¼šç”±å¦ˆå¦ˆæé—®è®°å½•ä¸‹å­©å­çš„å›ç­”ï¼Œæ‹ç…§ä¸Šä¼ ã€‚</p>
    
    <div class="inner-card">
      <p style="color:var(--text-main); font-size: 14px; margin-bottom:10px;">Q1: å¦‚æœå¦ˆå¦ˆæœ‰é­”æ³•ï¼Œç¬¬ä¸€ä»¶äº‹æƒ³å¸¦ä½ åšä»€ä¹ˆ?</p>
      <input type="text" id="g1a1" placeholder="æ¯”å¦‚ï¼šé£åˆ°äº‘æœµä¸Š">

      <p style="color:var(--text-main); margin: 20px 0 10px; font-size: 14px;">Q2: å¦‚æœè®©ä½ ç»™å¦ˆå¦ˆèµ·ä¸€ä¸ªè¶…çº§è‹±é›„çš„åå­—ï¼Œå«ä»€ä¹ˆ?</p>
      <div style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px;">
        <div class="quiz-option legs-option" onclick="selectLegs('å®¶åŠ¡ä¾ ', this)">å®¶åŠ¡ä¾ </div>
        <div class="quiz-option legs-option" onclick="selectLegs('åšé¥­è¶…äºº', this)">åšé¥­è¶…äºº</div>
        <div class="quiz-option legs-option" onclick="selectLegs('æŠ±æŠ±ä¾ ', this)">æŠ±æŠ±ä¾ </div>
        <div class="quiz-option legs-option" onclick="selectLegs('å” å¨ä¾ ', this)">å” å¨ä¾ </div>
      </div>
      <input type="hidden" id="g1a2">

      <p style="color:var(--text-main); margin: 20px 0 10px; font-size: 14px;">Q3: å¦‚æœæ˜Ÿæ˜Ÿå¯ä»¥åƒï¼Œä½ è§‰å¾—æ˜¯ä»€ä¹ˆå‘³é“?</p>
      <input type="text" id="g1a3" placeholder="æ¯”å¦‚ï¼šè‰è“å‘³è·³è·³ç³–">

      <p style="color:var(--text-main); margin: 20px 0 10px; font-size: 14px;">ä¸Šä¼ å®è´é“ç…§ï¼š</p>
      <input type="file" id="photo-input1" accept="image/*" capture="environment">
    </div>
    <button class="btn" onclick="generatePoster('game1')">ç”Ÿæˆé»˜å¥‘å†™çœŸæµ·æŠ¥</button>
    <div class="back-btn" onclick="navTo('page-main')">è¿”å›ä¸»é¡µ</div>
  </div>

  <!-- ================= ç©æ³•äºŒï¼šèŒå¨ƒè¡¨æƒ…å¤§èµ ================= -->
  <div id="page-game2" class="page">
    <h2 style="margin: 30px 0 10px; font-size: 24px; text-align:center;">èŒå¨ƒè¡¨æƒ…å¤§èµ</h2>
    <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Luna&backgroundColor=ffd5dc" class="cute-avatar" alt="å„¿ç«¥å¤´åƒ">
    
    <div class="inner-card" style="text-align: center;">
      <div style="font-size: 40px; margin-bottom: 5px;">ğŸ æŠ½ç­¾æŒ‘æˆ˜</div>
      <button class="btn" style="padding:12px; font-size:16px; margin: 15px 0; background:var(--icon-pink);" onclick="drawChallenge()">ğŸ² ç‚¹å‡»æŠ½å–åŠ¨ç‰©æ¨¡ä»¿ç§€</button>
      
      <div id="challengeDisplay" style="background:rgba(255,255,255,0.05); border-radius:16px; padding:20px; min-height:120px;">
        <p style="color:#ccc; line-height: 120px; margin:0;">ğŸ‘ˆ æŠ½ä¸€ä¸ªè¯•è¯•æ‰‹æ°”ï½</p>
      </div>

      <p style="color:var(--text-main); margin: 20px 0 10px; text-align: left; font-size: 14px;">æŠ“æ‹å®è´æŒ‘æˆ˜ä¸­çš„è¡¨æƒ…/åŠ¨ä½œï¼š</p>
      <input type="file" id="photo-input2" accept="image/*" capture="environment">
    </div>
    <button class="btn" style="background: var(--icon-pink);" onclick="generatePoster('game2')">ç”Ÿæˆè¡¨æƒ…åŒ…æµ·æŠ¥</button>
    <div class="back-btn" onclick="navTo('page-main')">è¿”å›ä¸»é¡µ</div>
  </div>

  <!-- ================= ç©æ³•ä¸‰ï¼šå®¶é•¿æ°”è´¨è¯„æµ‹ ================= -->
  <div id="page-game3" class="page">
    <h2 style="margin: 30px 0; font-size: 24px; text-align:center;">ç¡¬æ ¸å®¶é•¿è¯„æµ‹</h2>
    <div style="width:100%; text-align:right; color:var(--neon-purple); font-size:14px; margin-bottom:10px; font-weight:bold;"><span id="quiz-progress">1/3</span></div>
    <div class="inner-card">
      <h3 id="quiz-q" style="margin-bottom:25px; font-size:18px; line-height:1.5; color: #fff;">é¢˜ç›®åŠ è½½ä¸­...</h3>
      <div id="quiz-options"></div>
    </div>
    <div class="back-btn" onclick="navTo('page-main')">æ”¾å¼ƒç­”é¢˜ï¼Œè¿”å›ä¸»é¡µ</div>
  </div>

  <!-- ================= ç»“æœæµ·æŠ¥å±•ç¤ºé¡µ ================= -->
  <div id="page-poster" class="page">
    <h2 id="poster-page-title" style="margin: 20px 0; font-size: 24px; text-align:center;">ç”ŸæˆæˆåŠŸ</h2>
    
    <!-- è¦æ±‚2ï¼šå°† bottomHighlight ç§»è‡³æ­¤å¤„å˜æˆç½‘é¡µæ–‡å­— -->
    <p id="result-bottom-highlight" style="color:#D8B4FE; font-size:15px; margin-bottom:15px; text-align:center; font-weight:bold; display:none;"></p>
    
    <img id="posterPreview" src="" alt="æµ·æŠ¥ç”Ÿæˆä¸­...">
    
    <p style="color:var(--neon-purple); font-size: 16px; margin-top: 20px; font-weight: bold; text-align: center; animation: pulse 1.5s infinite;">ğŸ‘† è¯·é•¿æŒ‰ä¸Šæ–¹æµ·æŠ¥ä¿å­˜ï¼Œåˆ†äº«è‡³æœ‹å‹åœˆ</p>
    <style>@keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }</style>

    <div style="width: 100%; margin-top: 20px;">
      <button class="btn" onclick="navTo('page-form')">æˆ‘å·²åˆ†äº«æœ‹å‹åœˆï¼Œå»é¢†å¥– ğŸ</button>
      <button class="btn btn-outline" onclick="navTo('page-main')">è¿”å›é¦–é¡µ</button>
    </div>
  </div>

  <!-- ================= é¢†å¥–è¡¨å•é¡µ ================= -->
  <div id="page-form" class="page">
    <h2 style="margin: 30px 0 20px; font-size: 24px; text-align:center;">é”¦é²¤ç¤¼åŒ…ç™»è®°</h2>
    <p style="color:var(--text-sub); font-size:14px; margin-bottom:20px; text-align:center;">è¯·å®Œå–„ä¿¡æ¯ï¼Œæ–¹ä¾¿è€å¸ˆä¸ºæ‚¨æ ¸é”€å¥–å“</p>
    
    <div class="inner-card">
      <input type="text" id="form-name" placeholder="ğŸ‘¤ å®è´å§“å">
      <input type="tel" id="form-age" placeholder="ğŸ‚ å®è´å¹´é¾„">
      <input type="tel" id="form-phone" placeholder="ğŸ“± å®¶é•¿æ‰‹æœºå·">
      
      <div style="position: relative;">
        <select id="form-subject" required>
          <option value="" disabled selected hidden>ğŸ¨ è¯·é€‰æ‹©æ„Ÿå…´è¶£çš„ç§‘ç›®</option>
          <option value="å°‘å„¿ç¾æœ¯">å°‘å„¿ç¾æœ¯</option>
          <option value="å°‘å„¿å£æ‰">å°‘å„¿å£æ‰</option>
          <option value="å°‘å„¿èˆè¹ˆ">å°‘å„¿èˆè¹ˆ</option>
          <option value="ä¹¦æ³•">ç¡¬ç¬”/æ¯›ç¬”ä¹¦æ³•</option>
          <option value="å…¶ä»–">å…¶ä»–</option>
        </select>
        <div style="position: absolute; right: 15px; top: 18px; color: #5B607A; pointer-events: none;">â–¼</div>
      </div>
      
      <button class="btn" onclick="submitForm()">æäº¤æ ¸é”€ä¿¡æ¯</button>
      <p style="color: #F87171; font-size: 12px; margin-top: 15px; text-align: center; line-height: 1.5;">âš ï¸ æäº¤åè¯·åŠ¡å¿…ä¿ç•™æœ‹å‹åœˆè®°å½•ï¼Œ<br>ç°åœºæ ¸é”€éœ€å‡ºç¤ºæ‰‹æœºæˆªå›¾å“¦ï¼</p>
    </div>
  </div>

  <!-- ================= æœ€ç»ˆå¯¼æµé¡µ ================= -->
  <div id="page-finish" class="page">
    <div style="text-align: center; margin-top: 6vh;"><div style="font-size: 60px; margin-bottom: 20px;">ğŸ‰</div><h2 style="font-size: 28px; margin-bottom: 10px;">ç™»è®°æˆåŠŸ</h2></div>
    <div class="inner-card" style="text-align:center; margin-top: 20px;">
      <p style="font-size:16px; font-weight:bold; color:#fff; margin-bottom:20px;">æœ€åä¸€æ­¥ï¼šæ·»åŠ è€å¸ˆå¾®ä¿¡å‘æˆªå›¾</p>
      <div style="width:180px; height:180px; background:#fff; margin:0 auto; border-radius:16px; padding:10px;">
        <img src="qr.png" onerror="this.src='https://via.placeholder.com/160'" style="width:100%; height:100%; object-fit: contain;">
      </div>
      <p style="color:var(--neon-purple); font-size: 16px; font-weight:bold; margin-top: 20px;">é•¿æŒ‰è¯†åˆ«æ·»åŠ è€å¸ˆ</p>
      <p style="color:var(--text-sub); font-size:14px; margin-top:10px; line-height:1.6;">å‘é€æš—å· <span style="color:#fff;">ã€æœ‹å‹åœˆæˆªå›¾ã€‘</span><br>å³åˆ»ä¸ºæ‚¨é”å®šå¤§ç¤¼åŒ…ï¼</p>
    </div>
  </div>

  <!-- é«˜åº¦è®¾å®šä¸º1550ï¼Œé¢„ç•™å¤§æ ‡é¢˜å’Œåº•éƒ¨äºŒç»´ç å¡ç‰‡ç©ºé—´ -->
  <canvas id="posterCanvas" width="800" height="1550" style="display:none;"></canvas>

<script>
  /* ================= éŸ³ä¹æ§åˆ¶ ================= */
  const bgm = document.getElementById('bgm');
  const musicBtn = document.getElementById('music-btn');
  let musicPlayed = false;

  function toggleMusic() {
    if (bgm.paused) { bgm.play(); musicBtn.classList.remove('paused'); musicPlayed = true; } 
    else { bgm.pause(); musicBtn.classList.add('paused'); }
  }
  document.addEventListener('touchstart', function() {
    if(!musicPlayed) { bgm.play(); musicBtn.classList.remove('paused'); musicPlayed = true; }
  }, {once:true});

  function navTo(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    window.scrollTo(0,0);
    if(pageId === 'page-game3') startQuiz();
  }

  function selectLegs(val, el) {
    document.getElementById('g1a2').value = val;
    document.querySelectorAll('.legs-option').forEach(opt => opt.classList.remove('selected'));
    el.classList.add('selected');
  }

  /* ================= æŠ½ç­¾ ================= */
  const challenges = [
    { title: "å¤§çŒ©çŒ©æ¶èƒ¸", desc: "ä¸€è¾¹æ¶èƒ¸ä¸€è¾¹å‘å‡º'å‘œå‘œ'å£°ï¼Œè¶Šå‡¶è¶Šå¥½ç¬‘!", icon: "ğŸ¦" },
    { title: "å°å¤©é¹…é£é£", desc: "è¸®èµ·è„šå°–ï¼ŒåŒæ‰‹åšç¿…è†€ï¼Œä¼˜é›…ä¸­å¸¦ç‚¹æç¬‘", icon: "ğŸ¦¢" },
    { title: "ä¼é¹…æ‘‡æ‘‡æ™ƒæ™ƒ", desc: "ä¸¤æ‰‹è´´ç´§èº«ä½“ï¼Œå·¦å³æ‘‡æ‘†èµ°ï¼Œæœ€å¥½æ’åˆ°å¦ˆå¦ˆæ€€é‡Œ", icon: "ğŸ§" },
    { title: "å°èƒèŸ¹æ¨ªç€èµ°", desc: "æ¨ªç€èµ°ï¼Œä¸¤åªæ‰‹åšé’³å­", icon: "ğŸ¦€" },
    { title: "è¡¨æƒ…åŒ…äº”è¿æ‹", desc: "10 ç§’å†…æ ¹æ®æç¤ºå¿«é€Ÿè½¬æ¢ 5 ä¸ªè¡¨æƒ…ï¼šå¼€å¿ƒ-ç”Ÿæ°”-æƒŠè®¶-å§”å±ˆ-å‘å‘†", icon: "ğŸ¤ª" }
  ];
  let currentChallenge = null;

  function drawChallenge() {
    const displayDiv = document.getElementById('challengeDisplay');
    displayDiv.innerHTML = `<h3 style='color:#fff; font-size:20px; line-height: 80px;'>ğŸ² æŠ½å–ä¸­...</h3>`;
    setTimeout(() => {
      currentChallenge = challenges[Math.floor(Math.random() * challenges.length)];
      displayDiv.innerHTML = `
        <div style="font-size:50px; margin-bottom:10px;">${currentChallenge.icon}</div>
        <p style="color: var(--neon-purple); font-size: 22px; font-weight:bold; margin-bottom:5px;">${currentChallenge.title}</p>
        <p style="color: #fff; font-size: 14px; line-height:1.5;">${currentChallenge.desc}</p>
      `;
    }, 600);
  }

  /* ================= å¼‚æ­¥åŠ è½½å›¾ç‰‡å·¥å…·å‡½æ•° ================= */
  function loadImage(src) {
    return new Promise((resolve) => {
      const img = new Image();
      img.crossOrigin = "Anonymous";
      img.onload = () => resolve(img);
      img.onerror = () => resolve(null); // åŠ è½½å¤±è´¥è¿”å›nullï¼Œä¸é˜»å¡å…¶ä»–æµç¨‹
      img.src = src;
    });
  }

  /* ================= æµ·æŠ¥ç”Ÿæˆæ ¸å¿ƒå¼•æ“ (åŒ…å«å¤§æ ‡é¢˜ã€æ¨¡æ¿ä¸äºŒç»´ç æ¨¡å—) ================= */
  async function generatePoster(gameType) {
    let fileInput, quoteText = "", bottomHighlight = "";
    
    if (gameType === 'game1') {
      fileInput = document.getElementById('photo-input1').files[0];
      const q1 = document.getElementById('g1a1').value.trim() || "æ²¡æƒ³å¥½";
      const q2 = document.getElementById('g1a2').value;
      const q3 = document.getElementById('g1a3').value.trim() || "ç§˜å¯†";
      if (!q2) { alert("å¦‚æœè®©ä½ ç»™å¦ˆå¦ˆèµ·ä¸€ä¸ªè¶…çº§è‹±é›„çš„åå­—ï¼Œå«ä»€ä¹ˆ?"); return; }
      
      const answers = [
        `é­”ä»™å ¡å¦ˆå¦ˆçš„æ‰“å¡æ—¥å¸¸â€”${q1}`,
        `æˆ‘çš„å¦ˆå¦ˆæ˜¯è¶…çº§æ— æ•Œå®‡å®™æœ€é…·å¦ˆå¦ˆï¼Œå› ä¸ºå¥¹æ˜¯${q2}`,
        `æ˜Ÿæ˜Ÿå‘€æ˜Ÿæ˜Ÿï¼ŒåŸæ¥ä½ æ˜¯${q3}å‘³çš„`
      ];
      quoteText = answers[Math.floor(Math.random() * answers.length)];
      
      // è¦æ±‚2ï¼šå°†æç¤ºæ–‡å­—ç§»åˆ°ç½‘é¡µä¸Š
      bottomHighlight = "å­©å­çš„æƒ³æ³•è·Ÿå¦ˆå¦ˆä¸€æ ·å—ï¼ŒçœŸæ˜¯æœ‰åˆ›æ„å‘€ã€‚";
      document.getElementById('poster-page-title').innerText = "ç”ŸæˆæˆåŠŸ";

    } else if (gameType === 'game2') {
      fileInput = document.getElementById('photo-input2').files[0];
      if (!currentChallenge) { alert("è¯·å…ˆç‚¹å‡»æŠ½ç­¾ï¼ŒæŠ½å–ä¸€ä¸ªæŒ‘æˆ˜å§ï¼"); return; }
      
      quoteText = `æ­å–œå®è´æˆåŠŸæŒ‘æˆ˜â€œ${currentChallenge.title}â€æ¼”æŠ€ç‚¸è£‚ï¼Œç¬‘ç¿»å…¨åœºã€‚`;
      bottomHighlight = ""; 
      document.getElementById('poster-page-title').innerText = "æ­å–œï¼æŒ‘æˆ˜æˆåŠŸï¼";
    }

    if (!fileInput) { alert("è¯·å…ˆä¸Šä¼ ä¸€å¼ ç…§ç‰‡å“¦ï¼"); return; }

    // æ›´æ–°ç½‘é¡µä¸Šçš„æç¤ºæ–‡å­—
    const hlElem = document.getElementById('result-bottom-highlight');
    if(bottomHighlight) { hlElem.innerText = bottomHighlight; hlElem.style.display = "block"; } 
    else { hlElem.style.display = "none"; }

    // æç¤ºç”¨æˆ·æ­£åœ¨ç”Ÿæˆ
    document.getElementById('posterPreview').src = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='400'><text x='50%' y='50%' font-size='16' fill='%23B258FF' text-anchor='middle'>æµ·æŠ¥ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...</text></svg>";
    navTo('page-poster');

    // è¯»å–ç”¨æˆ·ä¸Šä¼ çš„ç…§ç‰‡Base64
    const userPhotoBase64 = await new Promise(resolve => {
        const reader = new FileReader();
        reader.onload = e => resolve(e.target.result);
        reader.readAsDataURL(fileInput);
    });

    // å¹¶å‘åŠ è½½æ‰€éœ€çš„å›¾ç‰‡ï¼šç”¨æˆ·ç…§ç‰‡ã€ç›¸æ¡†(frame.png)ã€äºŒç»´ç (qr.png)
    const [userImg, frameImg, qrImg] = await Promise.all([
        loadImage(userPhotoBase64),
        loadImage('frame.png'), 
        loadImage('qr.png')
    ]);

    // å¼€å§‹ç»˜åˆ¶
    const canvas = document.getElementById('posterCanvas');
    const ctx = canvas.getContext('2d');
    
    // 1. ç”»æ·±è‰²éœ“è™¹æ¸å˜èƒŒæ™¯
    const grad = ctx.createLinearGradient(0,0,0,1550);
    grad.addColorStop(0, '#1A1C35'); grad.addColorStop(1, '#0C0E1F');
    ctx.fillStyle = grad; ctx.fillRect(0,0,800,1550);

    // 2. è¦æ±‚3ï¼šå°†å¤§æ ‡é¢˜â€œæ˜Ÿæ²™èŒå¨ƒ æ°”è´¨å¤§èµâ€ç”»åœ¨æˆªå±æœ€é¡¶éƒ¨
    ctx.textAlign = "center";
    ctx.fillStyle = "#fff";
    ctx.font = "bold 85px 'PingFang SC', sans-serif";
    ctx.shadowColor = "rgba(178, 88, 255, 0.8)"; ctx.shadowBlur = 20;
    ctx.fillText("æ˜Ÿæ²™èŒå¨ƒ", 400, 120);
    ctx.fillText("æ°”è´¨å¤§èµ", 400, 220);
    ctx.shadowBlur = 0; // é‡ç½®é˜´å½±
    ctx.fillStyle = "#8E93A8";
    ctx.font = "bold 32px 'PingFang SC', sans-serif";
    ctx.fillText("å¯»æ‰¾å…¨æ˜Ÿæ²™æœ€ç¾èŒå¨ƒ", 400, 290);

    // 3. ç”»ç…§ç‰‡åº•æ¡†ä¸ç”¨æˆ·ç…§ç‰‡ (åæ ‡ Y: 340)
    // ä¸ºäº†é˜²æ­¢frame.pngç¼ºå¤±ï¼Œå…ˆç”»ä¸€ä¸ªç™½åº•å…œåº•
    ctx.fillStyle = '#fff'; 
    ctx.beginPath(); ctx.roundRect(50, 340, 700, 700, 20); ctx.fill();

    // è£å‰ªå¹¶å±…ä¸­ç»˜åˆ¶ç”¨æˆ·ç…§ç‰‡ï¼ˆç¨å¾®ç•™ä¸€ç‚¹å†…è¾¹è·ç»™ç›¸æ¡†ï¼‰
    const px = 60, py = 350, pw = 680, ph = 680;
    ctx.save();
    ctx.beginPath(); ctx.roundRect(px, py, pw, ph, 10); ctx.clip();
    let scale = Math.max(pw / userImg.width, ph / userImg.height);
    let sw = pw / scale, sh = ph / scale;
    let sx = (userImg.width - sw) / 2, sy = (userImg.height - sh) / 2;
    ctx.drawImage(userImg, sx, sy, sw, sh, px, py, pw, ph);
    ctx.restore();

    // 4. å°†æŠ å¥½çš„é€æ˜ç›¸æ¡† (frame.png) è¦†ç›–åœ¨ç…§ç‰‡ä¸Šé¢
    if(frameImg) {
        // å°†ç›¸æ¡†ä¸¥ä¸åˆç¼åœ°ç›–åœ¨ç…§ç‰‡åŒºåŸŸ
        ctx.drawImage(frameImg, 50, 340, 700, 700);
    }

    // 5. è¦æ±‚1ï¼šå‘†èŒå¤§å­—æ–‡æ¡ˆåŒºåŸŸ
    ctx.fillStyle = "rgba(255,255,255,0.08)";
    ctx.beginPath(); ctx.roundRect(50, 1070, 700, 180, 20); ctx.fill(); 
    
    // ä½¿ç”¨æ›´å‘†èŒæ´»æ³¼çš„å¤‡ç”¨å­—åº“ï¼Œå­—å·æ”¾å¤§è‡³ 42pxï¼Œé¢œè‰²é«˜äº®
    ctx.fillStyle = gameType === 'game1' ? "#E9D5FF" : "#FDA4AF";
    ctx.font = "bold 42px 'Comic Sans MS', 'STHupo', 'Kaiti', 'PingFang SC', sans-serif";
    ctx.shadowColor = "rgba(0, 0, 0, 0.5)"; ctx.shadowBlur = 4; // å¢åŠ ä¸€ç‚¹æ–‡å­—æŠ•å½±ä½¿å…¶æ›´é†’ç›®
    wrapText(ctx, quoteText, 400, 1145, 650, 55);
    ctx.shadowBlur = 0; // é‡ç½®é˜´å½±

    // 6. è¦æ±‚3ï¼šåº•éƒ¨æ‰«æäºŒç»´ç å‚ä¸çš„åŒºå— (Y: 1280)
    ctx.fillStyle = "rgba(255,255,255,0.05)";
    ctx.beginPath(); ctx.roundRect(40, 1280, 720, 240, 24); ctx.fill();
    
    ctx.strokeStyle = "rgba(255,255,255,0.15)";
    ctx.lineWidth = 2; ctx.setLineDash([10, 10]);
    ctx.stroke(); ctx.setLineDash([]); 

    ctx.fillStyle = "#fff"; 
    ctx.font = "bold 28px 'PingFang SC', sans-serif";
    ctx.fillText("æˆ‘ä¹Ÿè¦å‚ä¸æ¸¸æˆï¼Œé¢†å¼€å­¦æ–‡å…·ç¤¼åŒ… ğŸ", 400, 1340);

    // ç”»äºŒç»´ç èƒŒæ™¯ç™½æ¡†
    ctx.fillStyle = "#fff";
    ctx.beginPath(); ctx.roundRect(330, 1365, 140, 140, 16); ctx.fill();
    
    if(qrImg) {
      ctx.drawImage(qrImg, 340, 1375, 120, 120);
    } else {
      ctx.fillStyle = "#999"; ctx.font = "16px sans-serif"; ctx.fillText("ç¼ºå°‘qr.png", 400, 1445);
    }

    ctx.fillStyle = "#8E93A8"; 
    ctx.font = "22px 'PingFang SC', sans-serif";
    ctx.fillText("æˆªå±å‘æœ‹å‹åœˆï¼Œé•¿æŒ‰å¯è¯†åˆ«ä¸Šæ–¹äºŒç»´ç ", 400, 1550); // æœ€åº•ä¸‹çš„æç¤º

    // ç”Ÿæˆæœ€ç»ˆå›¾ç‰‡ç»™ç”¨æˆ·é•¿æŒ‰ä¿å­˜
    document.getElementById('posterPreview').src = canvas.toDataURL('image/jpeg', 0.9);
  }

  // è¾…åŠ©å‡½æ•°ï¼šCanvas è‡ªåŠ¨æ¢è¡Œä¸”å‚ç›´å±…ä¸­
  function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
    let words = text.split(''), line = '', lines = [];
    for (let n = 0; n < words.length; n++) {
      let testLine = line + words[n];
      let metrics = ctx.measureText(testLine);
      if (metrics.width > maxWidth && n > 0) { lines.push(line); line = words[n]; } 
      else { line = testLine; }
    }
    lines.push(line);
    let startY = y - ((lines.length - 1) * lineHeight) / 2;
    for (let i = 0; i < lines.length; i++) { ctx.fillText(lines[i], x, startY + (i * lineHeight)); }
  }

  /* ================= ç©æ³•ä¸‰ï¼šå®¶é•¿æ°”è´¨è¯„æµ‹ ================= */
  const quizData = [
    { q: "å‘¨æœ«å¸¦å­©å­å‡ºå»ç©ï¼Œä½ é€šå¸¸ä¼šï¼Ÿ", options: [{t:"åšè¯¦ç»†æ”»ç•¥ï¼ŒæŒ‰è®¡åˆ’èµ°", s:"A"}, {t:"éšå«éšèµ°ï¼Œä¸»æ‰“ä¸€ä¸ªéšæ€§", s:"B"}, {t:"ç»™å¨ƒæŠ¥ä¸ªä½“éªŒè¯¾ï¼Œæˆ‘åœ¨æ—è¾¹å–å’–å•¡", s:"C"}] },
    { q: "å­©å­å¼„è„äº†åˆšä¹°çš„æ–°è¡£æœï¼Œä½ çš„ååº”ï¼Ÿ", options: [{t:"å´©æºƒï¼é©¬ä¸Šè„±ä¸‹æ¥æ´—", s:"A"}, {t:"èµ¶ç´§æ‹ç…§å‘æœ‹å‹åœˆ", s:"B"}, {t:"è„å°±è„å§ï¼Œç©å¾—å¼€å¿ƒæœ€é‡è¦", s:"C"}] },
    { q: "ç»™å­©å­è¾…å¯¼ä½œä¸šæ—¶ï¼Œä½ çš„çŠ¶æ€æ˜¯ï¼Ÿ", options: [{t:"æ¯æ…ˆå­å­ï¼Œè€å¿ƒè®²è§£", s:"A"}, {t:"é¸¡é£ç‹—è·³ï¼Œéšæ—¶çˆ†å‘", s:"B"}, {t:"ç›´æ¥äº¤ç»™çˆ¸çˆ¸/è¾…å¯¼ç­", s:"C"}] }
  ];
  let currentQuiz = 0; let scores = { A:0, B:0, C:0 };

  function startQuiz() { currentQuiz = 0; scores = {A:0, B:0, C:0}; renderQuiz(); }

  function renderQuiz() {
    document.getElementById('quiz-progress').innerText = `${currentQuiz + 1} / 3`;
    document.getElementById('quiz-q').innerText = quizData[currentQuiz].q;
    let optsHtml = "";
    quizData[currentQuiz].options.forEach((opt) => {
      optsHtml += `<div class="quiz-option" onclick="selectOption('${opt.s}')">${opt.t}</div>`;
    });
    document.getElementById('quiz-options').innerHTML = optsHtml;
  }

  function selectOption(scoreType) {
    scores[scoreType]++;
    setTimeout(() => {
      if(currentQuiz < 2) { currentQuiz++; renderQuiz(); } 
      else { generateQuizResult(); }
    }, 200);
  }

  async function generateQuizResult() {
    let max = 'A';
    if(scores.B > scores[max]) max = 'B';
    if(scores.C > scores[max]) max = 'C';
    let res = max === 'A' ? "å…¨èƒ½æ“å¿ƒå‹è€å¦ˆ" : max === 'B' ? "å¿«ä¹æ”¾å…»å‹ç¡¬æ ¸çˆ¸å¦ˆ" : "ä½›ç³»èººå¹³å‹å®¶é•¿";

    document.getElementById('posterPreview').src = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='400'><text x='50%' y='50%' font-size='16' fill='%23B258FF' text-anchor='middle'>æŠ¥å‘Šç”Ÿæˆä¸­...</text></svg>";
    document.getElementById('result-bottom-highlight').style.display = "none";
    navTo('page-poster');

    const qrImg = await loadImage('qr.png');
    const canvas = document.getElementById('posterCanvas');
    const ctx = canvas.getContext('2d');
    
    // èƒŒæ™¯ä¸å¤§æ ‡é¢˜
    ctx.fillStyle = '#1A1C35'; ctx.fillRect(0,0,800,1550);
    ctx.textAlign = "center";
    ctx.fillStyle = "#fff"; ctx.font = "bold 85px 'PingFang SC', sans-serif";
    ctx.shadowColor = "rgba(178, 88, 255, 0.8)"; ctx.shadowBlur = 20;
    ctx.fillText("æ˜Ÿæ²™èŒå¨ƒ", 400, 120); ctx.fillText("æ°”è´¨å¤§èµ", 400, 220);
    ctx.shadowBlur = 0;
    ctx.fillStyle = "#8E93A8"; ctx.font = "bold 32px 'PingFang SC', sans-serif";
    ctx.fillText("å¯»æ‰¾å…¨æ˜Ÿæ²™æœ€ç¾èŒå¨ƒ", 400, 290);

    // æŠ¥å‘Šå†…å®¹æ¡†
    ctx.fillStyle = "rgba(255,255,255,0.05)";
    ctx.beginPath(); ctx.roundRect(50, 400, 700, 500, 30); ctx.fill();
    ctx.fillStyle = '#fff'; ctx.font = "bold 50px sans-serif"; 
    ctx.fillText("ç¡¬æ ¸å®¶é•¿é‰´å®šæŠ¥å‘Š", 400, 550);
    ctx.fillStyle = "#B258FF"; ctx.font = "bold 65px sans-serif";
    ctx.fillText(res, 400, 720);

    // åº•éƒ¨äºŒç»´ç å¼•å¯¼åŒº
    ctx.fillStyle = "rgba(255,255,255,0.05)";
    ctx.beginPath(); ctx.roundRect(40, 1280, 720, 240, 24); ctx.fill();
    ctx.strokeStyle = "rgba(255,255,255,0.15)"; ctx.lineWidth = 2; ctx.setLineDash([10, 10]); ctx.stroke(); ctx.setLineDash([]);
    ctx.fillStyle = "#fff"; ctx.font = "bold 28px 'PingFang SC', sans-serif";
    ctx.fillText("æˆ‘ä¹Ÿè¦å‚ä¸æ¸¸æˆï¼Œé¢†å¼€å­¦æ–‡å…·ç¤¼åŒ… ğŸ", 400, 1340);
    ctx.fillStyle = "#fff"; ctx.beginPath(); ctx.roundRect(330, 1365, 140, 140, 16); ctx.fill();
    if(qrImg) ctx.drawImage(qrImg, 340, 1375, 120, 120);
    ctx.fillStyle = "#8E93A8"; ctx.font = "22px 'PingFang SC', sans-serif";
    ctx.fillText("æˆªå±å‘æœ‹å‹åœˆï¼Œé•¿æŒ‰å¯è¯†åˆ«ä¸Šæ–¹äºŒç»´ç ", 400, 1550);

    document.getElementById('poster-page-title').innerText = "ç”ŸæˆæˆåŠŸ";
    document.getElementById('posterPreview').src = canvas.toDataURL('image/jpeg', 0.9);
  }

  /* ================= æäº¤è¡¨å• ================= */
  function submitForm() {
    const name = document.getElementById('form-name').value.trim();
    const age = document.getElementById('form-age').value.trim();
    const phone = document.getElementById('form-phone').value.trim();
    const subject = document.getElementById('form-subject').value;

    if(!name || !age || phone.length < 11 || !subject) { alert("è¯·æ­£ç¡®å®Œæ•´åœ°å¡«å†™æ‰€æœ‰ä¿¡æ¯å“¦~"); return; }
    
    // å¦‚æœæœ‰é£ä¹¦webhookè¯·æ›¿æ¢æ­¤å¤„ï¼Œå¦åˆ™é»˜è®¤è·³ä¸‹ä¸€æ­¥
    navTo('page-finish');
  }

  /* ä½ç‰ˆæœ¬æµè§ˆå™¨ Canvas roundRect å…¼å®¹ */
  if(!CanvasRenderingContext2D.prototype.roundRect) {
    CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
      if (w < 2 * r) r = w / 2; if (h < 2 * r) r = h / 2;
      this.moveTo(x + r, y); this.lineTo(x + w - r, y); this.quadraticCurveTo(x + w, y, x + w, y + r);
      this.lineTo(x + w, y + h - r); this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
      this.lineTo(x + r, y + h); this.quadraticCurveTo(x, y + h, x, y + h - r);
      this.lineTo(x, y + r); this.quadraticCurveTo(x, y, x + r, y); this.closePath(); return this;
    };
  }
</script>
</body>
</html>